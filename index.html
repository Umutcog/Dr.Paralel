<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEO-HACK V6.0: OMEGA PROTOCOL</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* CSS: PURE CYBERPUNK */
        body {
            background-color: #000;
            color: #0f0;
            font-family: 'VT323', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 5px;
            user-select: none;
            overflow: hidden;
        }

        /* CRT SCANLINE EFFECT (Tüplü Monitör Havası) */
        body::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        #game-terminal {
            width: 100%;
            max-width: 750px;
            border: 2px solid #0f0;
            background-color: #050505;
            position: relative;
            display: flex;
            flex-direction: column;
            height: 95vh;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.4);
            z-index: 1;
        }

        .top-bar {
            background: #0f0;
            color: #000;
            padding: 5px 15px;
            display: flex;
            justify-content: space-between;
            font-size: 20px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .main-screen {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            /* Hacker Grid Arka Plan */
            background-image: 
                linear-gradient(rgba(0, 255, 0, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 0, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Glitch Animasyonu (Hata Verince Titreme) */
        @keyframes glitch {
            0% { transform: translate(0) }
            20% { transform: translate(-2px, 2px) }
            40% { transform: translate(-2px, -2px) }
            60% { transform: translate(2px, 2px) }
            80% { transform: translate(2px, -2px) }
            100% { transform: translate(0) }
        }
        .shake { animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) both infinite; color: red; border-color: red !important; }

        .img-frame { 
            border: 1px solid #0f0; 
            margin-bottom: 15px; 
            height: 180px; 
            overflow: hidden; 
            position: relative;
        }
        #scene-image { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%) contrast(1.2) brightness(0.8); }

        .log-text { 
            font-size: 22px; line-height: 1.4; margin-bottom: 20px; color: #cfc; 
            text-shadow: 0 0 5px rgba(0,255,0,0.5);
        }

        /* TABLO STİLİ */
        .table-wrapper { overflow-x: auto; margin: 15px 0; border: 1px solid #0f0; box-shadow: 0 0 10px rgba(0,255,0,0.2); }
        .data-table { width: 100%; border-collapse: collapse; font-size: 18px; color: #0f0; text-align: center; min-width: 350px; }
        .data-table th { background: #003300; border: 1px solid #0f0; padding: 5px; }
        .data-table td { border: 1px solid #0f0; padding: 5px; cursor: crosshair; }
        .data-table td:hover { background: #0f0; color: #000; font-weight: bold; }

        /* INPUT */
        .input-group { display: flex; gap: 10px; margin-top: 15px; }
        input { 
            flex: 1; background: #000; border: 2px solid #0f0; color: #0f0; padding: 10px; 
            font-family: 'VT323', monospace; font-size: 24px; text-transform: uppercase; 
        }
        input:focus { outline: none; box-shadow: 0 0 15px #0f0; }

        /* BUTONLAR */
        .control-panel { padding: 15px; background: #000; border-top: 2px solid #0f0; display: grid; gap: 10px; }
        button {
            background: #000; border: 2px solid #0f0; color: #0f0;
            padding: 10px; font-family: 'VT323', monospace; font-size: 24px; cursor: pointer;
            text-transform: uppercase; transition: 0.1s; letter-spacing: 2px;
        }
        button:hover { background: #0f0; color: #000; box-shadow: 0 0 15px #0f0; }
        .btn-red { border-color: red; color: red; }
        .btn-red:hover { background: red; color: white; box-shadow: 0 0 15px red; }

        /* SÜRÜKLE BIRAK */
        .pool { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 10px; border: 1px dashed #0f0; margin-bottom: 15px; }
        .item { background: #002200; border: 1px solid #0f0; padding: 5px 10px; cursor: pointer; font-size: 20px; }
        .item.selected { background: #0f0; color: #000; }
        .zones { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .zone { border: 2px solid #0f0; padding: 10px; min-height: 100px; text-align: center; }
        .zone.active { background: #003300; }

        /* YENİ GEÇİŞ EFEKTİ (DATA LOAD) */
        #transition-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 99; display: none;
            justify-content: center; align-items: center; flex-direction: column;
        }
        .loader-bar { width: 300px; height: 20px; border: 2px solid #0f0; margin-top: 20px; position: relative; }
        .loader-fill { height: 100%; background: #0f0; width: 0%; transition: width 0.8s; }
        .term-text { font-size: 24px; color: #0f0; }

        /* Reklam Engelleyici */
        iframe, [class*="tiiny"], .tiiny-host-badge { display: none !important; }
    </style>
</head>
<body>

    <div id="game-terminal">
        <div class="top-bar">
            <span>// PROTOCOL: OMEGA //</span>
            <span id="score-disp">SECURE</span>
        </div>

        <div class="main-screen" id="main-screen">
            <div class="img-frame">
                <img id="scene-image" src="https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?w=800" alt="Cover">
            </div>
            
            <div id="game-text" class="log-text">
                > BAĞLANTI KURULUYOR...<br>
                > AJAN, İKLİM AĞINA SIZMAK İÇİN HAZIR MISIN?<br>
                > BAŞLAMAK İÇİN AŞAĞIDAKİ TERMİNALİ KULLAN.
            </div>
            
            <div id="dynamic-content"></div> 
            <div id="clue-box" style="margin-top:10px; font-size:18px; color:#666;"></div>
        </div>

        <div class="control-panel" id="controls">
            <button onclick="startGame()">[ SİSTEMİ BAŞLAT ]</button>
        </div>

        <div id="transition-screen">
            <div class="term-text">VERİLER ŞİFRELENİYOR...</div>
            <div class="loader-bar"><div class="loader-fill" id="loader-fill"></div></div>
            <div class="term-text" style="font-size:16px; margin-top:10px;">Packet Transfer: <span id="percent">0</span>%</div>
        </div>
    </div>

    <script>
        const googleFormLink = "https://docs.google.com/forms/d/e/1FAIpQLSetNN9DLHIN1mmEnwXKEljiq9I5lePMQ11LIjSjmBzvjc-qjA/viewform?usp=sharing&ouid=116024969586397151226"; 

        let score = 100;
        let selectedItem = null;

        // SES EFEKTLERİ
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if(type==='load'){ 
                // Modem sesi gibi cızırtılı yükleme
                osc.type='square'; osc.frequency.setValueAtTime(100, audioCtx.currentTime); 
                osc.frequency.linearRampToValueAtTime(800, audioCtx.currentTime+0.5); 
                gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime); 
                osc.start(); osc.stop(audioCtx.currentTime+0.5); 
            }
            else if(type==='success'){ 
                // Olumlu bip
                osc.type='sine'; osc.frequency.setValueAtTime(800, audioCtx.currentTime); 
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); 
                osc.start(); osc.stop(audioCtx.currentTime+0.1); 
            }
            else { 
                // Glitch sesi
                osc.type='sawtooth'; osc.frequency.setValueAtTime(60, audioCtx.currentTime); 
                gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime); 
                osc.start(); osc.stop(audioCtx.currentTime+0.3); 
            }
        }

        // --- SENARYO ---
        const scenario = [
            {
                id: 0,
                image: "https://images.unsplash.com/photo-1518182170546-0766aa6f7926?w=800",
                text: "> HEDEF: SİBİRYA NODE<br>> Veri sızıntısı tespit edildi.<br>> Hava: -10°C | Rüzgar: 20 km/sa<br>> Hissedilen sıcaklık şifresini gir.",
                clue: "// İPUCU: Tabloda -10 ve 20'nin kesişim noktası.",
                type: "input_table",
                correctAnswer: "-23", targetCorrect: 1, targetWrong: "wrong_0"
            },
            { id: "wrong_0", type: "dead_end", image: "https://images.unsplash.com/photo-1629814596134-2e2124707198?w=800", text: "> HATA: YANLIŞ KOORDİNAT<br>> Erişim engellendi. Tabloyu tekrar analiz et.", choices: [{text:"[ REBOOT ]", target:0}] },

            {
                id: 1,
                image: "https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800",
                text: "> HEDEF: NASA SERVER<br>> Dr. Paralel haritaları manipüle etti.<br>> 1880 vs 2019. En yüksek ısınma (Dark Red) hangi bölgede?",
                clue: "// İPUCU: Kutuplardaki değişime odaklan.",
                type: "map_compare",
                choices: [
                    { text: "A) EKVATOR HATTI", target: "wrong_1", cost: 5 },
                    { text: "B) KUZEY KUTBU", target: 2, cost: 0 }
                ]
            },
            { id: "wrong_1", type: "dead_end", image: "https://images.unsplash.com/photo-1569336415962-a4bd9f69cd83?w=800", text: "> HATA: YANLIŞ BÖLGE<br>> Ekvator stabil. Kutuplar eriyor.", choices: [{text:"[ GERİ DÖN ]", target:1}] },

            {
                id: 2,
                image: "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=800",
                text: "> HEDEF: AĞRI DAĞI<br>> Zirve sıcaklığı: -20°C (5137m)<br>> İndirgeme işlemi başlatılıyor...<br>> Deniz seviyesinde (0m) sıcaklık kaç olur?",
                clue: "// ALGORİTMA: 5000m fark / 200 = 25°C artış. -20 + 25 = ?",
                type: "input_simple",
                correctAnswer: "5", targetCorrect: 3, targetWrong: "wrong_2"
            },
            { id: "wrong_2", type: "dead_end", image: "https://images.unsplash.com/photo-1483921020237-2ff51e8e4b22?w=800", text: "> HATA: MATEMATİKSEL UYUMSUZLUK<br>> Aşağı indikçe hava ısınır. Ekleme yapmalısın.", choices: [{text:"[ TEKRAR HESAPLA ]", target:2}] },

            {
                id: 3,
                image: "https://images.unsplash.com/photo-1531366936337-7c912a4589a7?w=800",
                text: "> HEDEF: ALPLER<br>> Sıcaklık artışı algılandı.<br>> Soğuk seven flora (bitki) nereye hareket ediyor?",
                clue: "// İPUCU: Isınan havadan kaçmak için serin (yüksek) yerlere.",
                type: "choice",
                choices: [
                    { text: "A) AŞAĞI (ETEKLERE)", target: "wrong_3", cost: 5 },
                    { text: "B) YUKARI (ZİRVEYE)", target: 4, cost: 0 }
                ]
            },
            { id: "wrong_3", type: "dead_end", image: "https://images.unsplash.com/photo-1502082553048-f009c37129b9?w=800", text: "> HATA: AŞIRI ISINMA<br>> Aşağısı çok sıcak. Bitkiler yandı.", choices: [{text:"[ GERİ DÖN ]", target:3}] },

            {
                id: 4,
                image: "https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=800",
                text: "> HEDEF: ATLANTİK<br>> Enerji transferi gerekli.<br>> Avrupa'yı ısıtan SICAK su akıntısının kod adı nedir?",
                clue: "// İPUCU: G... S...",
                type: "choice",
                choices: [
                    { text: "A) LABRADOR", target: "wrong_4", cost: 5 },
                    { text: "B) GULF STREAM", target: 5, cost: 0 },
                    { text: "C) KANARYA", target: "wrong_4", cost: 5 }
                ]
            },
            { id: "wrong_4", type: "dead_end", image: "https://images.unsplash.com/photo-1498335707130-ba50285e74eb?w=800", text: "> HATA: SOĞUK AKINTI<br>> Sistem dondu. Sıcak akıntı lazım.", choices: [{text:"[ GERİ DÖN ]", target:4}] },

            {
                id: 5,
                image: "https://images.unsplash.com/photo-1504280501179-fac52dd2368f?w=800",
                text: "> HEDEF: NEM ANALİZİ<br>> Hangi bölgede nem oranı yüksektir?<br>> Verileri analiz et.",
                clue: "// İPUCU: Nemli yer yavaş ısınır, yavaş soğur. Fark azdır.",
                type: "choice",
                choices: [
                    { text: "A) GÜNDÜZ 40°C / GECE -5°C", target: "wrong_5", cost: 5 },
                    { text: "B) GÜNDÜZ 25°C / GECE 20°C", target: 6, cost: 0 }
                ]
            },
            { id: "wrong_5", type: "dead_end", image: "https://images.unsplash.com/photo-1541893335552-3620f5c1564f?w=800", text: "> HATA: ÇÖL ORTAMI<br>> Sıcaklık farkı çok yüksek. Bu kuraklıktır.", choices: [{text:"[ GERİ DÖN ]", target:5}] },

            {
                id: 6,
                image: "https://images.unsplash.com/photo-1524661135-423995f22d0b?w=800",
                text: "> HEDEF: İZOTERM HARİTASI<br>> Güney Yarım Küre verilerini tespit et.<br>> Eğriler nasıl görünmeli?",
                clue: "// İPUCU: Güneyde deniz çoktur, çizgiler düzgündür.",
                type: "choice",
                choices: [
                    { text: "A) ÇOK KIVRIMLI", target: "wrong_6", cost: 5 },
                    { text: "B) DÜZGÜN / PARALEL", target: 7, cost: 0 }
                ]
            },
            { id: "wrong_6", type: "dead_end", image: "https://images.unsplash.com/photo-1582213782179-e0d53f98f2ec?w=800", text: "> HATA: KUZEY YARIM KÜRE<br>> Kıvrımlar karalardan kaynaklanır.", choices: [{text:"[ GERİ DÖN ]", target:6}] },

            {
                id: 7,
                image: "https://images.unsplash.com/photo-1532978379173-523e16f371f2?w=800",
                text: "> HEDEF: GÖLGE BOYU<br>> 21 Mart ekinoksu.<br>> Gölgenin EN KISA (Sıfır) olduğu yer neresidir?",
                clue: "// İPUCU: Güneşin dik geldiği yer.",
                type: "choice",
                choices: [
                    { text: "A) KUTUPLAR", target: "wrong_7", cost: 5 },
                    { text: "B) EKVATOR", target: 8, cost: 0 }
                ]
            },
            { id: "wrong_7", type: "dead_end", image: "https://images.unsplash.com/photo-1478131143081-80f7f84ca84d?w=800", text: "> HATA: GÖLGE UZUNLUĞU<br>> Kutuplarda gölge uzundur.", choices: [{text:"[ GERİ DÖN ]", target:7}] },

            {
                id: 8,
                image: "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=800",
                text: "> HEDEF: TEHDİT ANALİZİ<br>> Hangi afet İKLİM DEĞİŞİKLİĞİ (Atmosfer) kaynaklı değildir?<br>> Doğal (Jeolojik) olanı ayır.",
                clue: "// İPUCU: Yerin altından geleni Jeolojik kutusuna at.",
                type: "sort_game",
                targetCorrect: 9,
                items: [
                    { id: "i1", text: "Sel", type: "iklim" },
                    { id: "i2", text: "Volkan", type: "jeolojik" },
                    { id: "i3", text: "Kuraklık", type: "iklim" },
                    { id: "i4", text: "Deprem", type: "jeolojik" }
                ],
                zones: [
                    { id: "iklim", label: "İKLİMSEL" },
                    { id: "jeolojik", label: "JEOLOJİK" }
                ]
            },

            {
                id: 9,
                image: "https://images.unsplash.com/photo-1521406606085-f37699317079?w=800",
                text: "> HEDEF: KAÇIŞ ENGELLEME<br>> Dr. Paralel'in motoru <b>-40°C</b> altında donuyor.<br>> Hangi rotada donar?",
                clue: "// İPUCU: Tabloda -40'tan daha küçük (soğuk) sayıyı bul.",
                type: "choice_table",
                choices: [
                    { text: "A) HAVA -15 / RÜZGAR 10", target: "wrong_8", cost: 5 }, 
                    { text: "B) HAVA -10 / RÜZGAR 30", target: "wrong_8", cost: 5 }, 
                    { text: "C) HAVA -20 / RÜZGAR 30", target: 99, cost: 0 }  
                ]
            },
            { id: "wrong_8", type: "dead_end", image: "https://images.unsplash.com/photo-1517480447814-68894451016c?w=800", text: "> HATA: HEDEF KAÇTI<br>> Motor donmadı.", choices: [{text:"[ TEKRAR DENE ]", target:9}] },

            {
                id: 99,
                image: "https://images.unsplash.com/photo-1579546929518-9e396f3cc809?w=800",
                text: "> GÖREV TAMAMLANDI.<br>> DÜNYA GÜVENDE.<br>> Raport Kodu oluşturuldu.",
                isEnd: true,
                choices: []
            }
        ];

        function startGame() { 
            score = 100; 
            if (audioCtx.state === 'suspended') audioCtx.resume();
            loadScene(0); 
        }

        function showTransition(callback) {
            const screen = document.getElementById("transition-screen");
            const fill = document.getElementById("loader-fill");
            const per = document.getElementById("percent");
            screen.style.display = "flex";
            playSound('load');
            
            // Yükleme Animasyonu
            setTimeout(() => { fill.style.width = "50%"; per.innerText = "50"; }, 100);
            setTimeout(() => { fill.style.width = "80%"; per.innerText = "80"; }, 400);
            setTimeout(() => { fill.style.width = "100%"; per.innerText = "100"; }, 700);

            setTimeout(() => {
                screen.style.display = "none";
                fill.style.width = "0%";
                callback();
            }, 900);
        }

        // GLITCH EFEKTİ
        function triggerGlitch() {
            const term = document.getElementById("game-terminal");
            term.classList.add("shake");
            playSound('error');
            setTimeout(() => term.classList.remove("shake"), 300);
        }

        function loadScene(sceneId) {
            const scene = scenario.find(s => s.id === sceneId);
            const controls = document.getElementById("controls");
            const textDiv = document.getElementById("game-text");
            const contentDiv = document.getElementById("dynamic-content");
            const image = document.getElementById("scene-image");
            
            controls.innerHTML = "";
            contentDiv.innerHTML = "";
            document.getElementById("clue-box").innerText = scene.clue || "";
            image.src = scene.image;
            textDiv.innerHTML = scene.text;

            // İçerik Oluşturma
            if(scene.type.includes("table")) renderTable(contentDiv);
            
            if(scene.type === "map_compare") {
                contentDiv.innerHTML = `
                    <div style="display:flex; gap:5px; overflow-x:auto; border:1px solid #0f0;">
                        <div style="flex:1; text-align:center;">
                            <img src="https://svs.gsfc.nasa.gov/vis/a000000/a004700/a004787/1884_Region.jpg" style="width:100%;"><br>1880
                        </div>
                        <div style="flex:1; text-align:center;">
                            <img src="https://svs.gsfc.nasa.gov/vis/a000000/a004700/a004787/2019_Region.jpg" style="width:100%;"><br>2019
                        </div>
                    </div>`;
            }

            // Kontroller (Butonlar/Input)
            if(scene.type === "input_table" || scene.type === "input_simple") {
                contentDiv.innerHTML += `
                    <div class="input-group">
                        <input type="text" id="ans" placeholder="_" autocomplete="off">
                        <button onclick="checkInput('${scene.correctAnswer}', ${scene.targetCorrect}, '${scene.targetWrong}')">SEND</button>
                    </div>`;
                
                // ENTER TUŞU DESTEĞİ
                setTimeout(() => {
                    const input = document.getElementById("ans");
                    input.focus();
                    input.addEventListener("keypress", function(event) {
                        if (event.key === "Enter") {
                            checkInput(scene.correctAnswer, scene.targetCorrect, scene.targetWrong);
                        }
                    });
                }, 100);
            } 
            else if(scene.type === "sort_game") {
                renderDragGame(scene, contentDiv);
            }
            else if(scene.isEnd) {
                const code = `OMEGA-${Math.floor(Math.random()*9000)+1000}-${score}`;
                contentDiv.innerHTML = `<div style="border:2px dashed #0f0; padding:20px; text-align:center; font-size:30px; margin:20px 0; color:#0f0;">${code}</div>`;
                controls.innerHTML = `<button onclick="window.open('${googleFormLink}', '_blank')">[ UPLOAD REPORT ]</button><button onclick="startGame()">[ RESTART SYSTEM ]</button>`;
            }
            else if(scene.choices) {
                scene.choices.forEach(c => {
                    const btn = document.createElement("button");
                    btn.innerText = c.text;
                    if(scene.type==="dead_end") btn.classList.add("btn-red");
                    btn.onclick = () => {
                        if(c.target.toString().startsWith("wrong") || scene.type==="dead_end") {
                            triggerGlitch(); if(c.cost) score-=c.cost; loadScene(c.target);
                        } else {
                            playSound('success'); if(c.cost) score-=c.cost;
                            showTransition(() => loadScene(c.target));
                        }
                    };
                    controls.appendChild(btn);
                });
            }
        }

        function renderTable(container) {
            container.innerHTML = `
            <div class="table-wrapper">
                <table class="data-table">
                    <tr><th style="background:#002200">WIND \\ TEMP</th><th>5°C</th><th>0°C</th><th>-5°C</th><th>-10°C</th><th>-15°C</th><th>-20°C</th></tr>
                    <tr><th>CALM</th><td>5</td><td>0</td><td>-5</td><td>-10</td><td>-15</td><td>-20</td></tr>
                    <tr><th>10 km/h</th><td>2</td><td>-3</td><td>-9</td><td>-14</td><td>-20</td><td>-26</td></tr>
                    <tr><th>20 km/h</th><td>-3</td><td>-10</td><td>-16</td><td>-23</td><td>-29</td><td>-35</td></tr>
                    <tr><th>30 km/h</th><td>-6</td><td>-13</td><td>-20</td><td>-27</td><td>-34</td><td>-42</td></tr>
                    <tr><th>40 km/h</th><td>-4</td><td>-15</td><td>-22</td><td>-29</td><td>-36</td><td>-43</td></tr>
                </table>
            </div>`;
        }

        function checkInput(correct, success, fail) {
            const val = document.getElementById("ans").value.trim();
            if(val === correct) { playSound('success'); showTransition(() => loadScene(success)); }
            else { triggerGlitch(); score-=5; loadScene(fail); }
        }

        // --- SÜRÜKLE BIRAK (BASİTLEŞTİRİLMİŞ TIKLAMA) ---
        function renderDragGame(scene, container) {
            const dragDiv = document.createElement("div");
            let poolHTML = ""; scene.items.forEach(i => poolHTML += `<div class="item" id="${i.id}" data-type="${i.type}" onclick="selectItem(this)">${i.text}</div>`);
            let zonesHTML = ""; scene.zones.forEach(z => zonesHTML += `<div class="zone" id="${z.id}" onclick="placeItem(this, ${scene.targetCorrect})"><h4>${z.label}</h4></div>`);
            dragDiv.innerHTML = `<div class="pool" id="pool">${poolHTML}</div><div class="zones">${zonesHTML}</div>`;
            container.appendChild(dragDiv);
        }

        function selectItem(el) {
            if(el.parentElement.classList.contains("zone")) return;
            document.querySelectorAll(".item").forEach(i => i.classList.remove("selected"));
            el.classList.add("selected");
            selectedItem = el;
            document.querySelectorAll(".zone").forEach(z => z.classList.add("active"));
        }

        function placeItem(zone, successTarget) {
            if(!selectedItem) return;
            zone.appendChild(selectedItem);
            selectedItem.classList.remove("selected");
            selectedItem = null;
            document.querySelectorAll(".zone").forEach(z => z.classList.remove("active"));
            
            if(document.getElementById("pool").children.length === 0) {
                let correct = true;
                document.querySelectorAll(".zone").forEach(z => {
                    Array.from(z.children).forEach(c => { if(c.classList.contains("item") && c.dataset.type !== z.id) correct = false; });
                });
                if(correct) { 
                    playSound('success'); 
                    document.getElementById("controls").innerHTML = `<button onclick="showTransition(() => loadScene(${successTarget}))">ACCESS GRANTED >></button>`;
                } else {
                    triggerGlitch(); score-=10;
                    alert("SYSTEM ERROR: WRONG CLASSIFICATION");
                    const scene = scenario.find(s => s.type === "sort_game");
                    loadScene(scene.id);
                }
            }
        }
    </script>
</body>
</html>

