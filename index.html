<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>NEBULA ONLINE: AJAN vs HIRSIZ</title>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root { --win-blue: #008080; --win-gray: #c0c0c0; --win-dark: #808080; }
        body { margin: 0; background-color: var(--win-blue); font-family: 'Tahoma', sans-serif; overflow: hidden; }
        
        /* GÄ°RÄ°Å EKRANI */
        #login-screen { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--win-blue); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .win-dialog { background: var(--win-gray); border: 2px outset white; width: 400px; padding: 20px; box-shadow: 10px 10px 0 black; }
        
        /* OYUN EKRANI */
        #desktop { display: none; width: 100vw; height: 100vh; }
        .window { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 800px; background: var(--win-gray); border: 2px outset white; box-shadow: 10px 10px 0 rgba(0,0,0,0.5); }
        .win-title { background: navy; color: white; padding: 3px 10px; font-weight: bold; display: flex; justify-content: space-between; font-size: 14px; }
        .win-body { padding: 15px; background: white; border: 2px inset var(--win-gray); margin: 5px; font-family: 'VT323'; height: 400px; overflow-y: auto; }

        /* DURUM Ã‡UBUÄU */
        #status-panel { background: #000; color: #0f0; padding: 10px; border: 2px inset white; margin-bottom: 10px; font-size: 20px; }
        .dist-track { height: 12px; background: #222; border: 1px solid #0f0; position: relative; margin-top: 5px; }
        #icon-player { position: absolute; left: 0; top: -10px; transition: 0.5s; font-size: 22px; }
        #icon-dr { position: absolute; left: 50%; top: -10px; transition: 0.5s; font-size: 22px; }

        /* BUTONLAR */
        .btn-win { background: var(--win-gray); border: 2px outset white; padding: 8px; cursor: pointer; font-family: 'VT323'; font-size: 20px; width: 100%; margin: 5px 0; }
        .btn-win:active { border-style: inset; }
        .btn-win:disabled { opacity: 0.5; cursor: not-allowed; }

        input { width: 100%; padding: 5px; margin: 10px 0; font-family: 'VT323'; font-size: 18px; border: 2px inset white; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="win-dialog">
            <div style="background:navy; color:white; padding:2px 5px; font-weight:bold; margin-bottom:10px;">SÄ°STEM BAÄLANTISI</div>
            <div id="my-id-display" style="font-weight:bold; margin-bottom:10px;">KODUNUZ OLUÅTURULUYOR...</div>
            <p>Oda kurmak iÃ§in kodu arkadaÅŸÄ±na ver veya arkadaÅŸÄ±nÄ±n kodunu aÅŸaÄŸÄ±ya yaz:</p>
            <input type="text" id="target-id" placeholder="ARKADAÅININ KODU">
            <button class="btn-win" onclick="connectToPeer()">OPERASYONA BAÄLAN</button>
            <p style="font-size:11px; color:red; margin-top:10px;">*Ä°ki oyuncu da aynÄ± sayfada olmalÄ±dÄ±r.</p>
        </div>
    </div>

    <div id="desktop">
        <div class="window">
            <div class="win-title">
                <span id="role-label">NEBULA TERMINAL</span>
                <span>x</span>
            </div>
            <div class="win-body">
                <div id="status-panel">
                    <div id="turn-info">BAÄLANTI BEKLENÄ°YOR...</div>
                    <div class="dist-track">
                        <div id="icon-player">ğŸ•µï¸</div>
                        <div id="icon-dr">ğŸ˜ˆ</div>
                    </div>
                </div>
                <div id="game-area">
                    <h2 id="q-text">Veri bekleniyor...</h2>
                    <div id="options-area"></div>
                </div>
            </div>
        </div>
    </div>

<script>
    let peer, conn;
    let myRole = ''; 
    let distance = 50; 
    let currentTaskIdx = 0;

    const tasks = [
        { q: "Hava olaylarÄ±nÄ±n dar bir alandaki kÄ±sa sÃ¼reli hali?", opts: ["HAVA DURUMU", "Ä°KLÄ°M"], ans: 0 },
        { q: "GÃ¶k taÅŸlarÄ±nÄ±n parÃ§alandÄ±ÄŸÄ± atmosfer katmanÄ±?", opts: ["MEZOSFER", "STRATOSFER"], ans: 0 },
        { q: "Kuzey YarÄ±m KÃ¼re'de okyanus akÄ±ntÄ±larÄ± nereye sapar?", opts: ["SAÄA", "SOLA"], ans: 0 },
        { q: "Beyaz yÃ¼zeylerin gÃ¼neÅŸ Ä±ÅŸÄ±ÄŸÄ±nÄ± yansÄ±tma gÃ¼cÃ¼?", opts: ["ALBEDO", "SERA ETKÄ°SÄ°"], ans: 0 },
        { q: "Ozon tabakasÄ± hangi katmandadÄ±r?", opts: ["STRATOSFER", "TROPOSFER"], ans: 0 }
    ];

    // PeerJS BaÅŸlatma
    peer = new Peer();

    peer.on('open', (id) => {
        document.getElementById('my-id-display').innerText = "SENÄ°N KODUN: " + id;
    });

    // Birisi sana baÄŸlandÄ±ÄŸÄ±nda (Sen Oda Kurucusun)
    peer.on('connection', (c) => {
        conn = c;
        myRole = 'ajan';
        initGame();
    });

    // Sen birine baÄŸlandÄ±ÄŸÄ±nda (Sen OperatÃ¶rsÃ¼n)
    function connectToPeer() {
        const targetId = document.getElementById('target-id').value;
        if(!targetId) return alert("Kod girmelisin!");
        conn = peer.connect(targetId);
        myRole = 'hirsiz';
        initGame();
    }

    function initGame() {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('desktop').style.display = 'block';
        document.getElementById('role-label').innerText = "ROLÃœN: " + myRole.toUpperCase();
        
        conn.on('data', (data) => {
            distance = data.d;
            currentTaskIdx = data.idx;
            render();
        });

        render();
    }

    function render() {
        document.getElementById('icon-dr').style.left = distance + "%";
        const area = document.getElementById('options-area');
        area.innerHTML = '';
        
        const task = tasks[currentTaskIdx % tasks.length];
        const isMyTurn = (myRole === 'hirsiz' && currentTaskIdx % 2 === 0) || (myRole === 'ajan' && currentTaskIdx % 2 !== 0);

        if (isMyTurn) {
            document.getElementById('turn-info').innerText = "SENÄ°N SIRAN! HAMLE YAP.";
            document.getElementById('q-text').innerText = task.q;
            task.opts.forEach((opt, i) => {
                const b = document.createElement('button');
                b.className = 'btn-win';
                b.innerText = opt;
                b.onclick = () => sendMove(i === task.ans);
                area.appendChild(b);
            });
        } else {
            document.getElementById('turn-info').innerText = "RAKÄ°P ANALÄ°Z YAPIYOR...";
            document.getElementById('q-text').innerText = "Siber veri transferi bekleniyor...";
        }

        // Kazanma KontrolÃ¼
        if(distance >= 95) { alert("DR. PARALEL KAÃ‡TI! HIRSIZ KAZANDI."); location.reload(); }
        if(distance <= 5) { alert("AJAN ENKA KELEPÃ‡EYÄ° TAKTI! AJAN KAZANDI."); location.reload(); }
    }

    function sendMove(correct) {
        if(myRole === 'hirsiz') distance += (correct ? 12 : -8);
        else distance -= (correct ? 15 : -10);
        
        currentTaskIdx++;
        conn.send({ d: distance, idx: currentTaskIdx });
        render();
    }
</script>
</body>
</html>
