<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEBULA: CYBER_OS v16.6</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root { --neon-green: #39FF14; --cyber-bg: #0a0a0a; --win-gray: #c0c0c0; --error-red: #ff0000; }
        body { margin: 0; background: var(--cyber-bg); font-family: 'VT323', monospace; color: var(--neon-green); overflow: hidden; transition: background 0.3s; }
        
        /* TitreÅŸim Animasyonu */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .shake { animation: shake 0.5s; }
        .flash-green { background: #004400 !important; }
        .flash-red { background: #440000 !important; }

        .desktop-icons { position: absolute; top: 20px; left: 20px; display: flex; flex-direction: column; gap: 25px; z-index: 1; }
        .icon { text-align: center; opacity: 0.7; }
        .icon-img { font-size: 30px; margin-bottom: 5px; }
        .icon-text { font-size: 14px; }

        #login-screen { position: fixed; top:0; left:0; width:100%; height:100%; z-index: 2000; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); }
        .win-dialog { background: var(--win-gray); border: 3px outset #eee; width: 360px; padding: 2px; box-shadow: 15px 15px 0 black; color: black; }
        .win-header { background: linear-gradient(90deg, #000080, #0080ff); color: white; padding: 5px; font-weight: bold; text-align: left; display: flex; justify-content: space-between; }
        
        .win-content { padding: 20px; background: #c0c0c0; border: 2px inset white; }
        input { width: 90%; padding: 10px; margin: 15px 0; border: 3px inset white; font-family: 'VT323'; font-size: 24px; text-align: center; background: black; color: var(--neon-green); }
        
        .btn-win { background: var(--win-gray); border: 3px outset white; padding: 10px; cursor: pointer; font-family: 'VT323'; font-size: 22px; width: 100%; font-weight: bold; margin-bottom: 5px;}
        .btn-win:hover { background: #e0e0e0; }

        #desktop { display: none; width: 100vw; height: 100vh; }
        .main-window { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 700px; background: var(--win-gray); border: 3px outset white; color: black; }
        .terminal-box { background: black; color: var(--neon-green); padding: 15px; border: 3px inset gray; min-height: 180px; position: relative; }
        
        .dist-track { height: 20px; background: #111; border: 2px solid var(--neon-green); position: relative; margin: 25px 0; border-radius: 4px; box-shadow: 0 0 10px var(--neon-green); }
        #icon-player { position: absolute; left: 0; top: -15px; transition: 1s ease; font-size: 30px; }
        #icon-dr { position: absolute; left: 50%; top: -15px; transition: 1s ease; font-size: 30px; }

        #log-area { font-size: 16px; margin-top: 10px; border-top: 1px solid #333; padding-top: 5px; color: #aaa; }
    </style>
</head>
<body id="body-main">

    <div class="desktop-icons">
        <div class="icon"><div class="icon-img">ğŸ—‘ï¸</div><div class="icon-text">Ã‡Ã¶p Kutusu</div></div>
        <div class="icon"><div class="icon-img">ğŸ’»</div><div class="icon-text">BilgisayarÄ±m</div></div>
        <div class="icon"><div class="icon-img">ğŸŒ</div><div class="icon-text">AÄŸ_BaÄŸlantÄ±larÄ±</div></div>
        <div class="icon" style="color: red;"><div class="icon-img">âš ï¸</div><div class="icon-text">Gizli_Dosya.doc</div></div>
    </div>

    <div id="login-screen">
        <div class="win-dialog">
            <div class="win-header"><span>SÄ°BER_GÄ°RÄ°Å_v16.6</span><span>X</span></div>
            <div class="win-content">
                <div id="status-msg">>> OPERASYON Ä°Ã‡Ä°N KOD GEREKLÄ°...</div>
                <input type="text" id="room-id" placeholder="OPERASYON_KODU">
                <button class="btn-win" onclick="joinRoom()">SÄ°STEME_SIZ_>></button>
            </div>
        </div>
    </div>

    <div id="desktop">
        <div class="main-window">
            <div class="win-header"><span>NEBULA_OS_TERMINAL</span><span>_ [] X</span></div>
            <div style="padding: 10px;">
                <div class="terminal-box" id="terminal">
                    <div id="turn-info">SÄ°NYAL_TARANIYOR...</div>
                    <div class="dist-track">
                        <div id="icon-player">ğŸ•µï¸</div>
                        <div id="icon-dr">ğŸ˜ˆ</div>
                    </div>
                    <div id="log-area">>> Sistem_Log: BaÄŸlantÄ± stabil.</div>
                </div>
                <div id="game-area" style="margin-top: 20px; text-align: center;">
                    <h2 id="q-text" style="font-size: 28px; color: #333;">VERÄ°_BEKLENÄ°YOR...</h2>
                    <div id="options-area"></div>
                </div>
            </div>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDYdIVHhh9HHjJAoaOKot8YbBQukgRKDC8",
        authDomain: "drparalel-1f0cd.firebaseapp.com",
        databaseURL: "https://drparalel-1f0cd-default-rtdb.firebaseio.com",
        projectId: "drparalel-1f0cd",
        storageBucket: "drparalel-1f0cd.firebasestorage.app",
        messagingSenderId: "464154880090",
        appId: "1:464154880090:web:bd2f540f76529d3ccc1063"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let myRole = '', roomId = '', state = { d: 50, idx: 0 };

    const tasks = [
        { q: "45Â° enlemindeki normal basÄ±nÃ§ deÄŸeri?", opts: ["1013 MB", "1033 MB"], ans: 0 },
        { q: "IsÄ±nan havada oluÅŸan basÄ±nÃ§ tipi?", opts: ["ALÃ‡AK BASINÃ‡", "YÃœKSEK BASINÃ‡"], ans: 0 },
        { q: "Hava merkezden dÄ±ÅŸa doÄŸru esiyorsa?", opts: ["ANTÄ°SÄ°KLON", "SÄ°KLON"], ans: 0 },
        { q: "Ekvator'daki sÃ¼rekli alÃ§ak basÄ±nÃ§ kuÅŸaÄŸÄ±?", opts: ["TERMÄ°K", "DÄ°NAMÄ°K"], ans: 0 },
        { q: "RÃ¼zgar hÄ±zÄ±nÄ± belirleyen basÄ±nÃ§ farkÄ±?", opts: ["GRADYAN", "KOROZYON"], ans: 0 },
        { q: "Haritadaki eÅŸ basÄ±nÃ§ eÄŸrilerinin adÄ±?", opts: ["Ä°ZOBAR", "Ä°ZOTERM"], ans: 0 },
        { q: "DaÄŸdan aÅŸaÄŸÄ± Ä±sÄ±narak inen kuru rÃ¼zgar?", opts: ["FÃ–N", "MÄ°STRAL"], ans: 0 }
    ];

    function joinRoom() {
        roomId = document.getElementById('room-id').value.trim().toUpperCase();
        if(!roomId) return;
        const roomRef = db.ref('rooms/' + roomId);
        roomRef.once('value', (snap) => {
            const data = snap.val();
            if (!data || !data.p1) {
                myRole = 'hirsiz';
                roomRef.update({ d: 50, idx: 0, p1: true, lastResult: '' });
                db.ref('rooms/' + roomId + '/p1').set(true);
                db.ref('rooms/' + roomId + '/p1').onDisconnect().remove();
                startSync();
            } else if (data.p1 && !data.p2) {
                myRole = 'ajan';
                roomRef.update({ p2: true });
                db.ref('rooms/' + roomId + '/p2').set(true);
                db.ref('rooms/' + roomId + '/p2').onDisconnect().remove();
                startSync();
            } else {
                document.getElementById('status-msg').innerText = "!! ODA DOLU !!";
            }
        });
    }

    function startSync() {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('desktop').style.display = 'block';
        db.ref('rooms/' + roomId).on('value', (snap) => {
            const data = snap.val();
            if(data) { 
                if(state.idx !== data.idx) triggerEffect(data.lastResult);
                state.d = data.d; 
                state.idx = data.idx; 
                render(data.p1 && data.p2); 
            }
        });
    }

    function triggerEffect(res) {
        if(!res) return;
        const body = document.getElementById('body-main');
        const term = document.getElementById('terminal');
        const log = document.getElementById('log-area');

        if(res.includes("BAÅARILI")) {
            body.classList.add('flash-green');
            log.style.color = "#39FF14";
            setTimeout(() => body.classList.remove('flash-green'), 300);
        } else {
            body.classList.add('flash-red');
            term.classList.add('shake');
            log.style.color = "red";
            setTimeout(() => {
                body.classList.remove('flash-red');
                term.classList.remove('shake');
            }, 500);
        }
        log.innerText = ">> RAKÄ°P ANALÄ°ZÄ°: " + res;
    }

    function render(gameActive) {
        document.getElementById('icon-dr').style.left = state.d + "%";
        const area = document.getElementById('options-area');
        area.innerHTML = '';
        
        if (!gameActive) {
            document.getElementById('turn-info').innerText = ">> SÄ°NYAL_ARANIYOR... [DÄ°ÄER AJAN BEKLENÄ°YOR]";
            document.getElementById('q-text').innerText = "KOD: " + roomId;
            return;
        }

        const task = tasks[state.idx % tasks.length];
        const isMyTurn = (myRole === 'hirsiz' && state.idx % 2 === 0) || (myRole === 'ajan' && state.idx % 2 !== 0);
        
        // Dinamik Durum MesajlarÄ±
        let statusTxt = "";
        if(state.d < 30) statusTxt = ">> DURUM: AJAN Ã‡OK YAKIN! SIKIÅTIRIYORUZ.";
        else if(state.d > 70) statusTxt = ">> DURUM: HEDEF KAÃ‡IYOR! Ä°ZÄ° KAYBEDÄ°YORUZ.";
        else statusTxt = ">> DURUM: TAKÄ°P SÃœRÃœYOR. MESAFE KORUNUYOR.";

        if (isMyTurn) {
            document.getElementById('turn-info').innerText = statusTxt;
            document.getElementById('q-text').innerText = task.q;
            task.opts.forEach((opt, i) => {
                const b = document.createElement('button');
                b.className = 'btn-win';
                b.innerText = opt;
                b.onclick = () => {
                    let newD = state.d;
                    let resultMsg = "";
                    if(i === task.ans) {
                        resultMsg = "BAÅARILI SIZMA! ";
                        if(myRole === 'hirsiz') { newD += 10; resultMsg += "Dr. Paralel uzaklaÅŸtÄ±."; }
                        else { newD -= 12; resultMsg += "Ajandan kaÃ§amÄ±yor!"; }
                    } else {
                        resultMsg = "KRÄ°TÄ°K HATA! DoÄŸru: " + task.opts[task.ans];
                        if(myRole === 'hirsiz') { newD -= 5; resultMsg += " Ajan yaklaÅŸÄ±yor."; }
                        else { newD += 7; resultMsg += " Dr. Paralel kaÃ§Ä±yor."; }
                    }
                    if(newD > 95) newD = 95; if(newD < 5) newD = 5;
                    db.ref('rooms/' + roomId).update({ d: newD, idx: state.idx + 1, lastResult: resultMsg });
                };
                area.appendChild(b);
            });
        } else {
            document.getElementById('turn-info').innerText = ">> RAKÄ°P SÄ°STEME SIZDI... VERÄ° BEKLENÄ°YOR.";
            document.getElementById('q-text').innerText = "SÄ°NYAL_ANALÄ°Z_EDÄ°LÄ°YOR...";
        }

        if(state.d >= 95) { alert("DR. PARALEL BULUTLARA KARIÅTI!"); reset(); }
        else if(state.d <= 5) { alert("OPERASYON TAMAMLANDI: AJAN ENKA KAZANDI!"); reset(); }
    }

    function reset() { 
        db.ref('rooms/' + roomId).remove(); 
        setTimeout(() => location.reload(), 500); 
    }
</script>
</body>
</html>
