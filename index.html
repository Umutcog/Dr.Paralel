<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM: DARK_PROTOCOL_V7.1</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* --- GENEL AYARLAR --- */
        body { margin: 0; padding: 0; background: #000; overflow: hidden; font-family: 'VT323', monospace; user-select: none; }
        
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 999;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 3px, 3px 100%;
        }

        /* --- FAKE OS (MASAÃœSTÃœ) --- */
        #desktop {
            width: 100vw; height: 100vh;
            background: #001100;
            background-image: radial-gradient(#003300 1px, transparent 1px);
            background-size: 30px 30px;
            display: flex; align-items: flex-start; padding: 20px;
            position: absolute; top: 0; left: 0; z-index: 10;
        }

        .icon { width: 80px; text-align: center; cursor: pointer; margin: 20px; transition: 0.2s; color: #0f0; }
        .icon:hover { transform: scale(1.1); text-shadow: 0 0 10px #0f0; }
        .icon span { font-size: 50px; display: block; }
        .icon p { font-size: 18px; margin-top: 5px; background: #000; padding: 2px; }

        /* --- OYUN PENCERESÄ° --- */
        #game-window {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 95%; max-width: 800px; height: 90vh;
            background: #000; border: 2px solid #0f0;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
            display: none; flex-direction: column; z-index: 20;
        }

        .win-header {
            background: #0f0; color: #000; padding: 5px 10px; font-weight: bold; font-size: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .close-btn { cursor: pointer; font-weight: bold; }

        .main-screen { flex: 1; overflow-y: auto; padding: 15px; color: #0f0; position: relative; }
        
        .img-frame { border: 1px solid #0f0; height: 180px; overflow: hidden; margin-bottom: 15px; position: relative; }
        #scene-image { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%) contrast(1.2); }

        .log-text { font-size: 22px; line-height: 1.4; color: #eee; margin-bottom: 20px; border-left: 4px solid #d32f2f; padding-left: 15px; }
        
        .clue-box { border: 1px dashed #00f3ff; color: #00f3ff; padding: 10px; margin-top: 15px; font-size: 18px; text-align: center; display: none; }

        #timer-box {
            position: absolute; top: 10px; right: 10px; font-size: 40px; color: red; font-weight: bold;
            text-shadow: 0 0 10px red; display: none; animation: blink 1s infinite;
        }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* TABLO & INPUT */
        .table-wrapper { overflow-x: auto; margin: 15px 0; border: 1px solid #0f0; }
        .data-table { width: 100%; border-collapse: collapse; font-size: 18px; color: #0f0; text-align: center; min-width: 350px; }
        .data-table th { background: #003300; border: 1px solid #0f0; padding: 5px; }
        .data-table td { border: 1px solid #0f0; padding: 5px; }

        .input-group { display: flex; gap: 10px; margin-top: 15px; }
        input { flex: 1; background: #000; border: 2px solid #0f0; color: #0f0; padding: 10px; font-family: 'VT323', monospace; font-size: 20px; text-transform: uppercase; }
        
        .control-panel { padding: 15px; background: #111; border-top: 2px solid #0f0; display: grid; gap: 10px; }
        button {
            background: #000; border: 2px solid #0f0; color: #0f0;
            padding: 12px; font-family: 'VT323', monospace; font-size: 22px; cursor: pointer;
            text-transform: uppercase; transition: 0.1s;
        }
        button:hover { background: #0f0; color: #000; }
        .btn-red { border-color: red; color: red; }
        
        .final-code { border: 4px dashed #00f3ff; color: #00f3ff; padding: 20px; font-size: 40px; text-align: center; margin: 20px 0; animation: pulse 2s infinite; }
        @keyframes pulse { 50% { opacity: 0.7; } }

        iframe, [class*="tiiny"], .tiiny-host-badge { display: none !important; }
    </style>
</head>
<body>

    <div class="scanlines"></div>

    <div id="desktop">
        <div class="icon" onclick="openGame()">
            <span>ğŸ“</span>
            <p>GÄ°ZLÄ°_DOSYALAR</p>
        </div>
        <div class="icon" onclick="alert('EriÅŸim Reddedildi: Sadece Yetkili Personel')">
            <span>ğŸ—‘ï¸</span>
            <p>Ã‡Ã–P KUTUSU</p>
        </div>
        <div style="position:absolute; bottom:20px; left:20px; color:#0f0; font-size:14px;">
            SYSTEM: ONLINE <br> USER: AGENT_007 <br> LOCATION: SECURE
        </div>
    </div>

    <div id="game-window">
        <div class="win-header">
            <span>>> TERMINAL_V7.1.exe</span>
            <span class="close-btn" onclick="location.reload()">[X]</span>
        </div>

        <div class="main-screen" id="main-screen">
            <div id="timer-box">30</div>
            <div class="img-frame">
                <img id="scene-image" src="" alt="Scene">
            </div>
            <div id="game-text" class="log-text"></div>
            <div id="dynamic-content"></div> 
            <div id="clue-box"></div>
        </div>

        <div class="control-panel" id="controls"></div>
    </div>

    <script>
        const googleFormLink = "https://docs.google.com/forms/d/e/1FAIpQLSetNN9DLHIN1mmEnwXKEljiq9I5lePMQ11LIjSjmBzvjc-qjA/viewform?usp=sharing&ouid=116024969586397151226"; 
        
        // --- ATATÃœRK BÃœSTÃœ ÅÄ°FRESÄ° ---
        const bustPassword = "KÄ°ÅÄ°NÄ°N BÄ°RÄ°NCÄ° HAKKI DOÄAL YETENEKLERÄ°NÄ° SERBESTÃ‡E GELÄ°ÅTÄ°REBÄ°LMESÄ°DÄ°R";

        let score = 100;
        let timerInterval;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            
            if(type==='boot') { 
                osc.frequency.value = 100; osc.frequency.linearRampToValueAtTime(1000, audioCtx.currentTime+0.5);
                gain.gain.value = 0.1; osc.start(); osc.stop(audioCtx.currentTime+0.5);
            }
            else if(type==='alarm') { 
                osc.type='square'; osc.frequency.value = 800; gain.gain.value = 0.05; osc.start(); osc.stop(audioCtx.currentTime+0.1);
            }
            else if(type==='success') {
                osc.type='sine'; osc.frequency.value = 600; osc.frequency.linearRampToValueAtTime(1200, audioCtx.currentTime+0.2);
                gain.gain.value = 0.1; osc.start(); osc.stop(audioCtx.currentTime+0.3);
            }
            else { 
                osc.type='sawtooth'; osc.frequency.value = 100; gain.gain.value = 0.2; osc.start(); osc.stop(audioCtx.currentTime+0.3);
            }
        }

        function openGame() {
            document.getElementById('desktop').style.display = 'none';
            document.getElementById('game-window').style.display = 'flex';
            playSound('boot');
            startGame();
        }

        // --- AKILLI METÄ°N TEMÄ°ZLEME FONKSÄ°YONU ---
        // TÃ¼rkÃ§e karakterleri Ä°ngilizceye Ã§evirir, noktalarÄ± siler
        function normalizeText(text) {
            let s = text.toUpperCase();
            s = s.replace(/Ä°/g, "I").replace(/Å/g, "S").replace(/Ä/g, "G").replace(/Ãœ/g, "U").replace(/Ã–/g, "O").replace(/Ã‡/g, "C");
            s = s.replace(/\./g, ""); // NoktayÄ± sil
            s = s.replace(/\s+/g, " "); // Fazla boÅŸluklarÄ± tek boÅŸluÄŸa indir
            return s.trim();
        }

        const scenario = [
            // 1. GÃ–REV (Tablo)
            {
                id: 0,
                image: "https://images.unsplash.com/photo-1518182170546-0766aa6f7926?w=800",
                text: "BAÄLANTI KURULDU...<br>Ajan! Dr. Paralel kaÃ§tÄ±. Sibirya Ã¼ssÃ¼ndeki 'Hissedilen SÄ±caklÄ±k' ÅŸifresini gir.<br>Veri: <b>Hava -10Â°C, RÃ¼zgar 20 km/sa</b>.",
                clue: "Tabloya bak: -10 ve 20'nin kesiÅŸimi.",
                type: "input_table",
                correctAnswer: "-23", targetCorrect: 1, targetWrong: "wrong_0"
            },
            { id: "wrong_0", type: "dead_end", image: "https://images.unsplash.com/photo-1629814596134-2e2124707198?w=800", text: "ERÄ°ÅÄ°M REDDEDÄ°LDÄ°. Tabloyu doÄŸru oku.", choices: [{text:"TEKRAR DENE", target:0}] },

            // 2. GÃ–REV (Harita)
            {
                id: 1,
                image: "https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800",
                text: "UYDU GÃ–RÃœNTÃœSÃœ ALINIYOR...<br>Dr. Paralel 'En Ã‡ok IsÄ±nan' bÃ¶lgeye saklandÄ±. 1880 ve 2019 haritalarÄ±nÄ± kÄ±yasla. En koyu kÄ±rmÄ±zÄ± (en Ã§ok Ä±sÄ±nan) yer neresi?",
                clue: "Kutuplara mÄ± Ekvatora mÄ± bakmalÄ±sÄ±n?",
                type: "map_compare",
                choices: [
                    { text: "A) EKVATOR ORMANLARI", target: "wrong_1", cost: 5 },
                    { text: "B) KUZEY KUTUP DAÄ°RESÄ°", target: 2, cost: 0 }
                ]
            },
            { id: "wrong_1", type: "dead_end", image: "https://images.unsplash.com/photo-1569336415962-a4bd9f69cd83?w=800", text: "YANLIÅ KONUM. Haritaya iyi bak, kutuplar yanÄ±yor.", choices: [{text:"GERÄ° DÃ–N", target:1}] },

            // 3. GÃ–REV (FÄ°ZÄ°KSEL - BAHÃ‡E ATATÃœRK BÃœSTÃœ)
            {
                id: 2,
                image: "https://images.unsplash.com/photo-1595126730969-ce4b3b28d612?w=800",
                text: "âš ï¸ SÄ°NYAL DIÅARIDAN GELÄ°YOR âš ï¸<br>Dr. Paralel anahtarÄ± bahÃ§eye gizledi!<br><br><b>GÃ–REV:</b> Okul bahÃ§esindeki <b>ATATÃœRK BÃœSTÃœ</b>'nÃ¼n yanÄ±na git. BÃ¼stÃ¼n Ã¶n yÃ¼zÃ¼nde yazan o uzun cÃ¼mleyi ÅŸifre olarak buraya gir.",
                clue: "BÃ¼stÃ¼n Ã¼zerindeki 'KiÅŸinin...' diye baÅŸlayan yazÄ±. (Nokta koymasan da olur).",
                type: "input_long_text", // Yeni tip: Uzun metin giriÅŸi
                correctAnswer: bustPassword, targetCorrect: 3, targetWrong: "wrong_qr"
            },
            { id: "wrong_qr", type: "dead_end", image: "https://images.unsplash.com/photo-1623018035782-b269248df916?w=800", text: "ÅÄ°FRE HATALI! Harf hatasÄ± yapmÄ±ÅŸ olabilirsin. YazÄ±yÄ± dikkatli oku ve tekrar yaz.", choices: [{text:"TEKRAR GÄ°R", target:2}] },

            // 4. GÃ–REV (YÃ¼kselti HesabÄ± - Tablosuz)
            {
                id: 3,
                image: "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=800",
                text: "SÄ°STEM ONLÄ°NE.<br>Ajan, AÄŸrÄ± DaÄŸÄ±'nÄ±n zirvesindesin (5000m). SÄ±caklÄ±k <b>-25Â°C</b>. Deniz seviyesine (0m) inersen sÄ±caklÄ±k kaÃ§ derece olur?<br><i>(Her 200m'de 1Â°C artar).</i>",
                clue: "5000 / 200 = 25 derece fark var. AÅŸaÄŸÄ±sÄ± daha sÄ±caktÄ±r. -25 + 25 = ?",
                type: "input_simple",
                correctAnswer: "0", targetCorrect: 4, targetWrong: "wrong_3"
            },
            { id: "wrong_3", type: "dead_end", image: "https://images.unsplash.com/photo-1483921020237-2ff51e8e4b22?w=800", text: "MATEMATÄ°K HATASI. -25 dereceye 25 derece eklersen sonuÃ§ ne olur?", choices: [{text:"TEKRAR HESAPLA", target:3}] },

            // 5. GÃ–REV (Bitki GÃ¶Ã§Ã¼)
            {
                id: 4,
                image: "https://images.unsplash.com/photo-1531366936337-7c912a4589a7?w=800",
                text: "Ä°SVÄ°Ã‡RE ALPLERÄ°...<br>KÃ¼resel Ä±sÄ±nma yÃ¼zÃ¼nden daÄŸdaki bitkiler 'serinlemek' iÃ§in nereye doÄŸru yayÄ±lÄ±yor?",
                clue: "Serinlik nerede? Zirvede mi etekte mi?",
                type: "choice",
                choices: [
                    { text: "A) AÅAÄI (ETEKLERE)", target: "wrong_4", cost: 5 },
                    { text: "B) YUKARI (ZÄ°RVEYE)", target: 5, cost: 0 }
                ]
            },
            { id: "wrong_4", type: "dead_end", image: "https://images.unsplash.com/photo-1502082553048-f009c37129b9?w=800", text: "YANLIÅ. AÅŸaÄŸÄ±sÄ± daha sÄ±cak, bitkiler Ã¶lÃ¼r.", choices: [{text:"GERÄ° DÃ–N", target:4}] },

            // 6. GÃ–REV (Okyanus AkÄ±ntÄ±sÄ±)
            {
                id: 5,
                image: "https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=800",
                text: "ATLANTÄ°K OKYANUSU...<br>Ä°ngiltere'ye gidiyoruz. Bizi Ä±sÄ±tacak sÄ±cak su akÄ±ntÄ±sÄ±nÄ±n adÄ± nedir?",
                clue: "G... S...",
                type: "choice",
                choices: [
                    { text: "A) LABRADOR", target: "wrong_5", cost: 5 },
                    { text: "B) GULF STREAM", target: 6, cost: 0 }
                ]
            },
            { id: "wrong_5", type: "dead_end", image: "https://images.unsplash.com/photo-1498335707130-ba50285e74eb?w=800", text: "O SOÄUK AKINTI! DonarÄ±z.", choices: [{text:"GERÄ° DÃ–N", target:5}] },

            // 7. GÃ–REV (FÄ°NAL VE GERÄ° SAYIM)
            {
                id: 6,
                image: "https://images.unsplash.com/photo-1521406606085-f37699317079?w=800",
                text: "ğŸš¨ ACÄ°L DURUM: MOTOR DONUYOR! ğŸš¨<br>Helikopterdeyiz. DÄ±ÅŸ sÄ±caklÄ±k <b>-15Â°C</b>. 3000 metre daha yÃ¼kseleceÄŸiz.<br>(Her 200m'de 1Â°C dÃ¼ÅŸer).<br>Yeni sÄ±caklÄ±k <b>-30Â°C</b>'den daha soÄŸuk olursa motor patlar. YÃœKSELELÄ°M MÄ°?",
                clue: "Hesapla: 3000/200 = 15 derece daha soÄŸuyacak. -15 - 15 = -30. SÄ±nÄ±rdayÄ±z.",
                type: "timer_decision", 
                timer: 45, // SÃ¼re biraz uzatÄ±ldÄ±, hesap yapsÄ±nlar
                choices: [
                    { text: "EVET, YÃœKSEL (RÄ°SKLÄ°)", target: 99, cost: 0 }, 
                    { text: "HAYIR, ALÃ‡AL (GÃœVENLÄ°)", target: "wrong_6", cost: 5 } 
                ]
            },
            { id: "wrong_6", type: "dead_end", image: "https://images.unsplash.com/photo-1517480447814-68894451016c?w=800", text: "YAKALANDIN! AlÃ§alÄ±nca Dr. Paralel'in adamlarÄ± seni vurdu. YÃ¼kselmen gerekiyordu.", choices: [{text:"TEKRAR DENE", target:6}] },

            // BÄ°TÄ°Å
            {
                id: 99,
                image: "https://images.unsplash.com/photo-1579546929518-9e396f3cc809?w=800",
                text: "GÃ–REV BAÅARILI!<br>DÃ¼nya kurtuldu.<br>AÅŸaÄŸÄ±daki kodu kopyala ve Ã¶ÄŸretmene raporla.",
                isEnd: true,
                choices: []
            }
        ];

        function startGame() { 
            score = 100; 
            loadScene(0); 
        }

        function startTimer(seconds, onTimeout) {
            const timerBox = document.getElementById("timer-box");
            timerBox.style.display = "block";
            let timeLeft = seconds;
            timerBox.innerText = timeLeft;
            
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                timerBox.innerText = timeLeft;
                playSound('alarm'); 
                if(timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerBox.style.display = "none";
                    onTimeout();
                }
            }, 1000);
        }

        function loadScene(sceneId) {
            const scene = scenario.find(s => s.id === sceneId);
            const controls = document.getElementById("controls");
            const textDiv = document.getElementById("game-text");
            const contentDiv = document.getElementById("dynamic-content");
            const image = document.getElementById("scene-image");
            const clueBox = document.getElementById("clue-box");
            const timerBox = document.getElementById("timer-box");

            // Temizlik
            controls.innerHTML = "";
            contentDiv.innerHTML = "";
            clueBox.innerHTML = ""; clueBox.style.display = "none";
            timerBox.style.display = "none"; clearInterval(timerInterval);
            
            image.src = scene.image;
            textDiv.innerHTML = scene.text;

            if(scene.clue) {
                clueBox.innerHTML = "IPUCU: " + scene.clue;
                clueBox.style.display = "block";
            }

            if(scene.timer) {
                startTimer(scene.timer, () => {
                    alert("SÃœRE DOLDU! Motor dondu.");
                    score -= 20;
                    loadScene(sceneId); 
                });
            }

            // --- Ä°Ã‡ERÄ°K TÄ°PLERÄ° ---

            // 1. TABLO OKUMA
            if(scene.type === "input_table") {
                contentDiv.innerHTML = `
                <div class="table-wrapper">
                    <table class="data-table">
                        <tr><th style="background:#222">RÃœZGAR/HAVA</th><th>0Â°C</th><th>-5Â°C</th><th>-10Â°C</th></tr>
                        <tr><th>10 km/sa</th><td>-3</td><td>-9</td><td>-14</td></tr>
                        <tr><th>20 km/sa</th><td>-10</td><td>-16</td><td>-23</td></tr>
                        <tr><th>30 km/sa</th><td>-13</td><td>-20</td><td>-27</td></tr>
                    </table>
                </div>
                <div class="input-group"><input type="text" id="ans" placeholder="ÅÄ°FRE..."><button onclick="checkInput('${scene.correctAnswer}', ${scene.targetCorrect}, '${scene.targetWrong}', false)">GÃ–NDER</button></div>`;
                bindEnter(scene, false);
            }

            // 2. HARÄ°TA
            else if(scene.type === "map_compare") {
                contentDiv.innerHTML = `<div style="display:flex; gap:5px;"><img src="https://svs.gsfc.nasa.gov/vis/a000000/a004700/a004787/1884_Region.jpg" style="width:50%"><img src="https://svs.gsfc.nasa.gov/vis/a000000/a004700/a004787/2019_Region.jpg" style="width:50%"></div>`;
            }

            // 3. FÄ°ZÄ°KSEL BAHÃ‡E GÃ–REVÄ° (UZUN METÄ°N)
            else if(scene.type === "input_long_text") {
                contentDiv.innerHTML = `
                    <div style="margin-top:10px;">
                        <textarea id="ans" rows="4" style="width:100%; background:#000; border:2px solid #0f0; color:#0f0; font-family:'VT323'; font-size:20px; padding:10px; text-transform:uppercase;" placeholder="BÃœSTTEKÄ° YAZIYI BURAYA YAZ..."></textarea>
                        <button style="width:100%; margin-top:10px;" onclick="checkInput('${scene.correctAnswer}', ${scene.targetCorrect}, '${scene.targetWrong}', true)">ÅÄ°FREYÄ° ONAYLA</button>
                    </div>`;
                // Textarea iÃ§in enter event'i biraz farklÄ± olabilir ama butonla basmalarÄ± daha gÃ¼venli
            }

            // 4. BASÄ°T INPUT
            else if(scene.type === "input_simple") {
                contentDiv.innerHTML = `<div class="input-group"><input type="text" id="ans" placeholder="CEVAP..."><button onclick="checkInput('${scene.correctAnswer}', ${scene.targetCorrect}, '${scene.targetWrong}', false)">ONAYLA</button></div>`;
                bindEnter(scene, false);
            }

            // 5. BÄ°TÄ°Å (RAPOR BUTONU)
            else if(scene.isEnd) {
                const code = `DARK-OPS-${Math.floor(Math.random()*9000)+1000}`;
                contentDiv.innerHTML = `<div class="final-code">${code}</div>`;
                
                const btnReport = document.createElement("button");
                btnReport.innerText = ">> RAPORU GÃ–NDER (TIKLA)";
                btnReport.onclick = () => window.open(googleFormLink, "_blank");
                controls.appendChild(btnReport);

                const btnRestart = document.createElement("button");
                btnRestart.innerText = "YENÄ°DEN BAÅLAT";
                btnRestart.onclick = () => location.reload();
                controls.appendChild(btnRestart);
                return; 
            }

            // 6. SEÃ‡ENEKLER
            if(scene.choices) {
                scene.choices.forEach(c => {
                    const btn = document.createElement("button");
                    btn.innerText = c.text;
                    if(scene.type === "dead_end") btn.classList.add("btn-red");
                    btn.onclick = () => {
                        if(c.target.toString().startsWith("wrong")) {
                            playSound('error'); score-=5; loadScene(c.target);
                        } else {
                            playSound('success'); loadScene(c.target);
                        }
                    };
                    controls.appendChild(btn);
                });
            }
        }

        // isTextCheck: True ise akÄ±llÄ± metin kontrolÃ¼ yapar (Nokta siler, I/Ä° dÃ¼zeltir)
        function checkInput(correct, success, fail, isTextCheck) {
            let val = document.getElementById("ans").value;
            let target = correct;

            if (isTextCheck) {
                // Her iki tarafÄ± da normalize et (TÃ¼rkÃ§e/Ä°ngilizce esnekliÄŸi)
                val = normalizeText(val);
                target = normalizeText(target);
            } else {
                val = val.toUpperCase().trim();
            }

            if(val === target) { playSound('success'); loadScene(success); }
            else { playSound('error'); score-=5; loadScene(fail); }
        }

        function bindEnter(scene, isTextCheck) {
            setTimeout(() => {
                const input = document.getElementById("ans");
                if(input) {
                    input.focus();
                    input.onkeypress = (e) => { 
                        if(e.key === "Enter") checkInput(scene.correctAnswer, scene.targetCorrect, scene.targetWrong, isTextCheck); 
                    };
                }
            }, 100);
        }
    </script>
</body>
</html>
