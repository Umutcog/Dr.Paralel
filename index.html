<script>
    // ... (Üst kısımdaki CSS ve HTML aynı) ...

    const tasks = [
        // ... (1. Soru aynı)
        { 
            dr: "Bileşen sistemini hackledim! Atmosfer ve hidrosfer dışında hiçbir şey bırakmadım!", 
            text: "İklim sistemindeki 5 temel bileşenden atmosfer ve hidrosfer sağlam. Kalan 3 bileşeni aralarına virgül koyarak gir (Örn: LİTOSFER, BİYOSFER, KRİYOSFER). Sıralama önemli değil!", 
            ans: ["LİTOSFER", "BİYOSFER", "KRİYOSFER"], // Dizi olarak tanımladık
            type: "input_match_all", // Özel tip
            meb: "Sayfa 91" 
        },
        // ... (Diğer sorular aynı)
    ];

    function check(v) {
        const task = tasks[currentStep];
        
        // Çoklu kelime kontrolü (Sıralama bağımsız)
        if (task.type === "input_match_all") {
            const userWords = v.toUpperCase().replace(/\s+/g, '').split(',').map(w => normalizeTurkish(w));
            const correctWords = task.ans.map(w => normalizeTurkish(w));
            
            // Her iki liste de aynı kelimeleri içeriyor mu?
            const isCorrect = correctWords.length === userWords.length && 
                              correctWords.every(w => userWords.includes(w));

            if (isCorrect) {
                distance -= 10;
                currentStep++;
                loadScene(currentStep);
            } else {
                distance += 15;
                alert("YANLIŞ! Eksik veya hatalı bileşen girdin. Dr. Paralel uzaklaşıyor!");
                updateDist();
            }
            return;
        }

        // Standart kontrol
        const clean = (s) => normalizeTurkish(s.replace(/\s+/g, '').toUpperCase().trim());
        if(clean(v) === clean(task.ans)) { 
            distance -= 10; currentStep++; loadScene(currentStep); 
        } else { 
            distance += 15; alert("YANLIŞ VERİ! Dr. Paralel kaçıyor!"); updateDist(); 
        }
    }

    // Türkçe karakterleri standartlaştıran yardımcı fonksiyon
    function normalizeTurkish(s) {
        return s.replace(/İ/g,"I").replace(/Ş/g,"S").replace(/Ğ/g,"G").replace(/Ü/g,"U").replace(/Ö/g,"O").replace(/Ç/g,"C");
    }
</script>
