<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEBULA: CYBER_OS v17.0</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root { --neon-green: #39FF14; --cyber-bg: #050505; --win-gray: #c0c0c0; }
        body { margin: 0; background: var(--cyber-bg); font-family: 'VT323', monospace; color: var(--neon-green); overflow: hidden; }
        
        /* Efektler */
        @keyframes shake { 0%, 100% {transform: translate(0,0);} 25% {transform: translate(-5px,2px);} 75% {transform: translate(5px,-2px);} }
        .shake { animation: shake 0.2s ease-in-out 2; }
        .flash-green { background: #003300 !important; }
        .flash-red { background: #330000 !important; }

        /* Masa√ºst√º Simgeleri */
        .desktop-icons { position: absolute; top: 15px; left: 15px; display: grid; grid-template-columns: repeat(2, 90px); gap: 20px; z-index: 1; }
        .icon { text-align: center; opacity: 0.5; font-size: 13px; color: white; }
        .icon-img { font-size: 30px; margin-bottom: 2px; }

        /* Pencereler */
        #login-screen { position: fixed; top:0; left:0; width:100%; height:100%; z-index: 2000; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.9); }
        .win-dialog { background: var(--win-gray); border: 3px outset #eee; width: 360px; padding: 2px; box-shadow: 12px 12px 0 black; color: black; }
        .win-header { background: linear-gradient(90deg, #000080, #0080ff); color: white; padding: 6px; font-weight: bold; display: flex; justify-content: space-between; }
        .win-content { padding: 15px; background: #c0c0c0; border: 2px inset white; }
        
        input { width: 90%; padding: 10px; margin: 15px 0; border: 3px inset white; font-family: 'VT323'; font-size: 26px; text-align: center; background: black; color: var(--neon-green); }
        .btn-win { background: var(--win-gray); border: 3px outset white; padding: 12px; cursor: pointer; font-family: 'VT323'; font-size: 22px; width: 100%; font-weight: bold; }

        /* Oyun Terminali */
        #desktop { display: none; width: 100vw; height: 100vh; }
        .main-window { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 95%; max-width: 750px; background: var(--win-gray); border: 3px outset white; color: black; }
        .terminal-box { background: black; color: var(--neon-green); padding: 12px; border: 3px inset gray; min-height: 190px; }
        
        /* Takip Sistemi */
        .dist-track { height: 40px; background: #111; border: 2px solid var(--neon-green); position: relative; margin: 40px 0; border-radius: 6px; }
        .char-icon { position: absolute; transition: 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); font-size: 34px; text-align: center; width: 60px; z-index: 5; }
        .char-label { font-size: 11px; display: block; background: rgba(0,0,0,0.8); color: white; padding: 2px 4px; border-radius: 4px; margin-top: -4px; }
        .is-me { filter: drop-shadow(0 0 10px var(--neon-green)); }
        .is-me .char-label { color: gold; border: 1px solid gold; font-weight: bold; }
    </style>
</head>
<body id="body-main">

    <div class="desktop-icons">
        <div class="icon"><div class="icon-img">üñ•Ô∏è</div>Sistem</div>
        <div class="icon"><div class="icon-img">üóëÔ∏è</div>Geri_D√∂n√º≈ü√ºm</div>
        <div class="icon"><div class="icon-img">üìÅ</div>Veri_Ar≈üivi</div>
        <div class="icon"><div class="icon-img">üì°</div>Sinyal_Tarayƒ±cƒ±</div>
        <div class="icon"><div class="icon-img">üõ°Ô∏è</div>G√ºvenlik</div>
        <div class="icon"><div class="icon-img">‚ò£Ô∏è</div>Malware</div>
        <div class="icon"><div class="icon-img">üîå</div>Proxy_List</div>
        <div class="icon" style="color:red"><div class="icon-img">üö®</div>HEDEF_TRACK</div>
    </div>

    <div id="login-screen">
        <div class="win-dialog">
            <div class="win-header"><span>NEBULA_LOGIN_v17.0</span></div>
            <div class="win-content">
                <div id="status-msg">>> OPERASYON KODU BEKLENƒ∞YOR...</div>
                <input type="text" id="room-id" placeholder="ODA KODUNU Gƒ∞R">
                <button class="btn-win" onclick="joinRoom()">OPERASYONA KATIL</button>
            </div>
        </div>
    </div>

    <div id="desktop">
        <div class="main-window">
            <div class="win-header"><span>OPERASYON_TERMƒ∞NALƒ∞</span><span>_ [] X</span></div>
            <div style="padding: 12px;">
                <div id="role-indicator" style="font-size: 22px; font-weight: bold; background: #000; color: #39FF14; padding: 10px; text-align: center; border: 2px dashed #39FF14; margin-bottom: 15px;">BAƒûLANTI_KURULUYOR...</div>
                <div class="terminal-box" id="terminal">
                    <div id="turn-info">Sƒ∞NYAL_ARANIYOR...</div>
                    <div class="dist-track">
                        <div id="char-ajan" class="char-icon">üïµÔ∏è<span class="char-label">AJAN</span></div>
                        <div id="char-hirsiz" class="char-icon">üòà<span class="char-label">HEDEF</span></div>
                    </div>
                    <div id="log-area" style="font-size:14px; color:#555; margin-top:20px; border-top: 1px solid #333; padding-top: 5px;">>> Sistem loglarƒ± hazƒ±r.</div>
                </div>
                <div id="game-area" style="margin-top: 20px; text-align: center;">
                    <h2 id="q-text" style="font-size: 26px; color: #111; min-height: 70px;">...</h2>
                    <div id="options-area"></div>
                </div>
            </div>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDYdIVHhh9HHjJAoaOKot8YbBQukgRKDC8",
        authDomain: "drparalel-1f0cd.firebaseapp.com",
        databaseURL: "https://drparalel-1f0cd-default-rtdb.firebaseio.com",
        projectId: "drparalel-1f0cd",
        storageBucket: "drparalel-1f0cd.firebasestorage.app",
        messagingSenderId: "464154880090",
        appId: "1:464154880090:web:bd2f540f76529d3ccc1063"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let myRole = '', roomId = '', state = { ajanP: 0, hirsizP: 50, idx: 0 };

    const tasks = [
        { q: "45¬∞ enlemindeki normal basƒ±n√ß deƒüeri?", opts: ["1013 MB", "1033 MB"], ans: 0 },
        { q: "Isƒ±nan havada olu≈üan basƒ±n√ß tipi?", opts: ["AL√áAK BASIN√á", "Y√úKSEK BASIN√á"], ans: 0 },
        { q: "Hava merkezden dƒ±≈üa doƒüru esiyorsa?", opts: ["ANTƒ∞Sƒ∞KLON", "Sƒ∞KLON"], ans: 0 },
        { q: "Ekvator'daki s√ºrekli al√ßak basƒ±n√ß ku≈üaƒüƒ±?", opts: ["TERMƒ∞K", "Dƒ∞NAMƒ∞K"], ans: 0 },
        { q: "R√ºzgar hƒ±zƒ±nƒ± belirleyen basƒ±n√ß farkƒ±?", opts: ["GRADYAN", "KOROZYON"], ans: 0 },
        { q: "Haritadaki e≈ü basƒ±n√ß eƒürilerinin adƒ±?", opts: ["ƒ∞ZOBAR", "ƒ∞ZOTERM"], ans: 0 },
        { q: "Daƒüdan a≈üaƒüƒ± ƒ±sƒ±narak inen kuru r√ºzgar?", opts: ["F√ñN", "Mƒ∞STRAL"], ans: 0 }
    ];

    function joinRoom() {
        roomId = document.getElementById('room-id').value.trim().toUpperCase();
        if(!roomId) return;
        const roomRef = db.ref('rooms/' + roomId);
        roomRef.once('value', (snap) => {
            const data = snap.val();
            if (!data || !data.p1) {
                myRole = 'hirsiz';
                roomRef.update({ ajanP: 0, hirsizP: 50, idx: 0, p1: true });
                db.ref('rooms/' + roomId + '/p1').onDisconnect().remove();
                startSync();
            } else if (data.p1 && !data.p2) {
                myRole = 'ajan';
                roomRef.update({ p2: true });
                db.ref('rooms/' + roomId + '/p2').onDisconnect().remove();
                startSync();
            } else {
                document.getElementById('status-msg').innerText = "!! Sƒ∞STEM DOLU !!";
            }
        });
    }

    function startSync() {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('desktop').style.display = 'block';
        document.getElementById('role-indicator').innerText = "ROL√úN√úZ: " + (myRole === 'hirsiz' ? "HEDEF (DR. PARALEL)" : "Sƒ∞BER AJAN");
        document.getElementById(myRole === 'hirsiz' ? 'char-hirsiz' : 'char-ajan').classList.add('is-me');

        db.ref('rooms/' + roomId).on('value', (snap) => {
            const data = snap.val();
            if(data) { 
                if(state.idx !== data.idx) triggerEffect(data.lastResult);
                state = data;
                render(data.p1 && data.p2); 
            }
        });
    }

    function triggerEffect(res) {
        if(!res) return;
        const body = document.getElementById('body-main');
        if(res.includes("BA≈ûARILI")) {
            body.classList.add('flash-green');
            setTimeout(() => body.classList.remove('flash-green'), 300);
        } else {
            body.classList.add('flash-red');
            document.getElementById('terminal').classList.add('shake');
            setTimeout(() => { body.classList.remove('flash-red'); document.getElementById('terminal').classList.remove('shake'); }, 400);
        }
        document.getElementById('log-area').innerText = ">> SON ANALƒ∞Z: " + res;
    }

    function render(gameActive) {
        document.getElementById('char-ajan').style.left = state.ajanP + "%";
        document.getElementById('char-hirsiz').style.left = state.hirsizP + "%";
        const area = document.getElementById('options-area');
        area.innerHTML = '';
        if (!gameActive) {
            document.getElementById('turn-info').innerText = ">> RAKƒ∞P Sƒ∞NYALƒ∞ BEKLENƒ∞YOR...";
            return;
        }

        const task = tasks[state.idx % tasks.length];
        const isMyTurn = (myRole === 'hirsiz' && state.idx % 2 === 0) || (myRole === 'ajan' && state.idx % 2 !== 0);

        if (isMyTurn) {
            document.getElementById('turn-info').innerText = ">> SENƒ∞N SIRAN! VERƒ∞ Gƒ∞Rƒ∞≈ûƒ∞ YAP.";
            document.getElementById('q-text').innerText = task.q;
            let opts = task.opts.map((t, i) => ({ t, i })).sort(() => Math.random() - 0.5);
            opts.forEach((opt) => {
                const b = document.createElement('button');
                b.className = 'btn-win';
                b.innerText = opt.t;
                b.onclick = () => {
                    let newAjan = state.ajanP, newHirsiz = state.hirsizP, res = "";
                    if(opt.i === task.ans) {
                        res = "BA≈ûARILI SIZMA!";
                        if(myRole === 'hirsiz') newHirsiz += 12; else newAjan += 15;
                    } else {
                        res = "HATA! DOƒûRU CEVAP: " + task.opts[task.ans];
                        if(myRole === 'hirsiz') newHirsiz -= 5; else newAjan -= 8;
                    }
                    newAjan = Math.max(0, Math.min(newAjan, 90));
                    newHirsiz = Math.max(0, Math.min(newHirsiz, 92));
                    db.ref('rooms/' + roomId).update({ ajanP: newAjan, hirsizP: newHirsiz, idx: state.idx + 1, lastResult: res });
                };
                area.appendChild(b);
            });
        } else {
            document.getElementById('turn-info').innerText = ">> RAKƒ∞P SIZMA YAPIYOR...";
            document.getElementById('q-text').innerText = "VERƒ∞ PAKETƒ∞ BEKLENƒ∞YOR...";
        }

        if(state.hirsizP >= 92) { alert("DR. PARALEL KA√áTI!"); reset(); }
        else if(state.ajanP >= (state.hirsizP - 2)) { alert("AJAN YAKALADI!"); reset(); }
    }

    function reset() { db.ref('rooms/' + roomId).remove(); setTimeout(() => location.reload(), 500); }
</script>
</body>
</html>
