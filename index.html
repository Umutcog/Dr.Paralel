<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>NEBULA: CLOUD_SYNC OPERASYONU</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root { --win-blue: #008080; --win-gray: #c0c0c0; }
        body { margin: 0; background: var(--win-blue); font-family: 'Tahoma', sans-serif; overflow: hidden; }
        #login-screen { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--win-blue); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .win-dialog { background: var(--win-gray); border: 2px outset white; width: 320px; padding: 15px; box-shadow: 8px 8px 0 black; text-align: center; }
        #desktop { display: none; width: 100vw; height: 100vh; }
        .window { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 95%; max-width: 650px; background: var(--win-gray); border: 2px outset white; }
        .win-title { background: navy; color: white; padding: 4px; font-weight: bold; font-size: 13px; text-align: left; }
        .win-body { padding: 10px; background: white; border: 2px inset var(--win-gray); margin: 4px; font-family: 'VT323'; min-height: 350px; }
        .btn-win { background: var(--win-gray); border: 2px outset white; padding: 10px; cursor: pointer; font-family: 'VT323'; font-size: 18px; width: 100%; margin-top: 5px; }
        .dist-track { height: 12px; background: #222; border: 1px solid #0f0; position: relative; margin: 15px 0; }
        #icon-player { position: absolute; left: 0; top: -10px; transition: 1s ease; font-size: 22px; }
        #icon-dr { position: absolute; left: 50%; top: -10px; transition: 1s ease; font-size: 22px; }
        input { width: 90%; padding: 8px; margin: 10px 0; border: 2px inset white; font-family: 'VT323'; font-size: 20px; text-align: center; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="win-dialog">
            <div style="background:navy; color:white; padding:2px; font-weight:bold; margin-bottom:10px; text-align:left;">BULUT_GIRIS_PANELI</div>
            <div id="status-msg">BULUTA BAGLANILIYOR...</div>
            <input type="text" id="room-id" placeholder="4 HANELI ODA KODU">
            <button class="btn-win" onclick="joinRoom()">OPERASYONA KATIL</button>
            <p style="font-size:11px; margin-top:10px;">*Aynƒ± kodu giren iki √∂ƒürenci e≈üle≈üir.</p>
        </div>
    </div>

    <div id="desktop">
        <div class="window">
            <div class="win-title" id="role-label">NEBULA TERMINAL</div>
            <div class="win-body">
                <div style="background:black; color:#0f0; padding:8px; border:2px inset white;">
                    <div id="turn-info">VERƒ∞ AKI≈ûI AKTƒ∞F...</div>
                    <div class="dist-track"><div id="icon-player">üïµÔ∏è</div><div id="icon-dr">üòà</div></div>
                </div>
                <div id="game-area" style="color:black; margin-top:10px;">
                    <h2 id="q-text" style="font-size:24px;">Y√ºkleniyor...</h2>
                    <div id="options-area"></div>
                </div>
            </div>
        </div>
    </div>

<script>
    // PAYLA≈ûTIƒûIN FIREBASE Bƒ∞LGƒ∞LERƒ∞ ENTEGRE EDƒ∞LDƒ∞
    const firebaseConfig = {
        apiKey: "AIzaSyDYdIVHhh9HHjJAoaOKot8YbBQukgRKDC8",
        authDomain: "drparalel-1f0cd.firebaseapp.com",
        databaseURL: "https://drparalel-1f0cd-default-rtdb.firebaseio.com",
        projectId: "drparalel-1f0cd",
        storageBucket: "drparalel-1f0cd.firebasestorage.app",
        messagingSenderId: "464154880090",
        appId: "1:464154880090:web:bd2f540f76529d3ccc1063"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    let myRole = ''; 
    let roomId = '';
    let state = { d: 50, idx: 0 };

    // BASIN√á VE R√úZGARLAR G√ñREVLERƒ∞ (11-20)
    const tasks = [
        { q: "45¬∞ enlemindeki normal basƒ±n√ß deƒüeri nedir?", opts: ["1013 MB", "1033 MB"], ans: 0 },
        { q: "Isƒ±nan havada olu≈üan basƒ±n√ß tipi hangisidir?", opts: ["AL√áAK BASIN√á", "Y√úKSEK BASIN√á"], ans: 0 },
        { q: "Hava akƒ±mƒ±nƒ±n merkezden dƒ±≈üa doƒüru olduƒüu basƒ±n√ß?", opts: ["ANTƒ∞Sƒ∞KLON", "Sƒ∞KLON"], ans: 0 },
        { q: "K.Y.K'de r√ºzgarƒ±n saƒüa saptƒ±ƒüƒ± basƒ±n√ß merkezi?", opts: ["Y√úKSEK BASIN√á", "AL√áAK BASIN√á"], ans: 0 },
        { q: "Ekvator'daki s√ºrekli al√ßak basƒ±n√ß ku≈üaƒüƒ±nƒ±n k√∂keni?", opts: ["TERMƒ∞K", "Dƒ∞NAMƒ∞K"], ans: 0 },
        { q: "30¬∞ enleminde havanƒ±n al√ßalƒ±p yƒ±ƒüƒ±ldƒ±ƒüƒ± ku≈üak?", opts: ["Dƒ∞NAMƒ∞K Y.B.", "TERMƒ∞K Y.B."], ans: 0 },
        { q: "R√ºzgarƒ±n hƒ±zƒ±nƒ± belirleyen basƒ±n√ß farkƒ± g√ºc√º?", opts: ["GRADYAN", "KOROZYON"], ans: 0 },
        { q: "E≈ü basƒ±n√ß eƒürilerinin coƒürafi adƒ± nedir?", opts: ["ƒ∞ZOBAR", "ƒ∞ZOTERM"], ans: 0 },
        { q: "G√ºnd√ºz vadiden daƒüa doƒüru esen yerel r√ºzgar?", opts: ["VADƒ∞ MELTEMƒ∞", "DAƒû MELTEMƒ∞"], ans: 0 },
        { q: "Daƒüdan a≈üaƒüƒ± inerken ƒ±sƒ±nan kuru ve sƒ±cak r√ºzgar?", opts: ["F√ñN", "Mƒ∞STRAL"], ans: 0 }
    ];

    function joinRoom() {
        roomId = document.getElementById('room-id').value.trim().toUpperCase();
        if(!roomId) return alert("L√ºtfen kod girin!");
        
        const roomRef = db.ref('rooms/' + roomId);
        roomRef.once('value', (snap) => {
            if(!snap.exists()) {
                myRole = 'hirsiz';
                roomRef.set({ d: 50, idx: 0, p1: true });
            } else {
                myRole = 'ajan';
                roomRef.update({ p2: true });
            }
            startSync();
        });
    }

    function startSync() {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('desktop').style.display = 'block';
        document.getElementById('role-label').innerText = "OPERASYON: " + myRole.toUpperCase();

        db.ref('rooms/' + roomId).on('value', (snap) => {
            const data = snap.val();
            if(data) {
                state.d = data.d;
                state.idx = data.idx;
                render();
            }
        });
    }

    function render() {
        document.getElementById('icon-dr').style.left = state.d + "%";
        const area = document.getElementById('options-area');
        area.innerHTML = '';
        const task = tasks[state.idx % tasks.length];
        const isMyTurn = (myRole === 'hirsiz' && state.idx % 2 === 0) || (myRole === 'ajan' && state.idx % 2 !== 0);

        if (isMyTurn) {
            document.getElementById('turn-info').innerText = ">> SIRA SENDE! KAR≈ûI HAMLE YAP.";
            document.getElementById('q-text').innerText = task.q;
            task.opts.forEach((opt, i) => {
                const b = document.createElement('button');
                b.className = 'btn-win';
                b.innerText = opt;
                b.onclick = () => {
                    let newD = state.d;
                    if(myRole === 'hirsiz') newD += (i === task.ans ? 10 : -5);
                    else newD -= (i === task.ans ? 12 : -7);
                    db.ref('rooms/' + roomId).update({ d: newD, idx: state.idx + 1 });
                };
                area.appendChild(b);
            });
        } else {
            document.getElementById('turn-info').innerText = ">> RAKƒ∞P ANALƒ∞Z YAPIYOR...";
            document.getElementById('q-text').innerText = "Bulut verisi senkronize ediliyor...";
        }

        if(state.d >= 95) { alert("DR. PARALEL KA√áTI!"); resetRoom(); }
        if(state.d <= 5) { alert("AJAN ENKA YAKALADI!"); resetRoom(); }
    }

    function resetRoom() {
        db.ref('rooms/' + roomId).remove();
        location.reload();
    }

    document.getElementById('status-msg').innerText = "BULUT SISTEMI HAZIR.";
</script>
</body>
</html>
