<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEO-HACK V4.1: SESLİ OPERASYON</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        /* CSS: Carmen Sandiego / Hacker Hibrit Tema */
        body {
            background-color: #1a1a1a;
            color: #00ff41;
            font-family: 'Share Tech Mono', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            user-select: none;
            overflow: hidden;
        }

        #game-terminal {
            width: 100%;
            max-width: 650px;
            border: 4px solid #333;
            background-color: #000;
            position: relative;
            display: flex;
            flex-direction: column;
            height: 95vh;
            box-shadow: 0 0 40px rgba(0, 255, 65, 0.15);
        }

        .top-bar {
            background: #222;
            border-bottom: 2px solid #00ff41;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            font-size: 16px;
            color: #fff;
        }
        .badge { background: #d32f2f; color: #fff; padding: 2px 8px; border-radius: 3px; font-size: 12px; letter-spacing: 1px; }

        .main-screen {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            background: repeating-linear-gradient(0deg, rgba(0, 255, 65, 0.02) 0px, rgba(0, 255, 65, 0.02) 1px, transparent 1px, transparent 2px);
        }

        .img-frame { border: 2px solid #555; padding: 3px; margin-bottom: 15px; background: #111; }
        #scene-image { width: 100%; height: 180px; object-fit: cover; display: block; filter: grayscale(80%) sepia(20%) contrast(1.2); }

        .log-text { 
            font-size: 16px; line-height: 1.6; margin-bottom: 15px; color: #ddd; 
            border-left: 3px solid #d32f2f; padding-left: 10px; min-height: 60px;
        }

        /* TABLO TASARIMI */
        .table-wrapper { overflow-x: auto; margin: 15px 0; border: 1px solid #444; }
        .data-table { width: 100%; border-collapse: collapse; font-size: 13px; color: #ccc; text-align: center; min-width: 320px; }
        .data-table th { background: #222; color: #00ff41; padding: 8px; border: 1px solid #444; }
        .data-table td { border: 1px solid #444; padding: 6px; cursor: crosshair; }
        .data-table tr:hover { background: #111; }
        .data-table td:hover { background: #004400; color: #fff; }

        /* SÜRÜKLE BIRAK */
        .drag-area { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .pool { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; padding: 10px; border: 1px dashed #555; }
        .item { background: #003300; border: 1px solid #00ff41; padding: 5px 10px; cursor: pointer; font-size: 13px; }
        .item.selected { background: #00ff41; color: #000; }
        .zones { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .zone { border: 2px solid #444; padding: 10px; min-height: 80px; text-align: center; }
        .zone h4 { margin: 0 0 5px 0; font-size: 12px; color: #aaa; }
        .zone.active { border-color: #00ff41; background: #0b220b; }

        .input-group { display: flex; gap: 10px; margin-top: 10px; }
        input { flex: 1; background: #111; border: 1px solid #00ff41; color: #00ff41; padding: 12px; font-family: inherit; font-size: 18px; text-transform: uppercase; }
        
        .control-panel { padding: 15px; background: #1a1a1a; display: grid; grid-template-columns: 1fr; gap: 10px; }
        button {
            background: #000; border: 1px solid #00ff41; color: #00ff41;
            padding: 15px; font-family: inherit; font-size: 16px; cursor: pointer;
            text-transform: uppercase; font-weight: bold; transition: 0.2s;
        }
        button:hover { background: #00ff41; color: #000; }
        .btn-red { border-color: #d32f2f; color: #d32f2f; }
        
        #plane-animation {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100; display: none;
            justify-content: center; align-items: center; flex-direction: column;
        }
        .plane-icon { font-size: 50px; animation: fly 2s linear infinite; }
        @keyframes fly { 0% { transform: translateX(-100px) translateY(20px) rotate(10deg); } 50% { transform: translateX(0) translateY(-20px) rotate(-10deg); } 100% { transform: translateX(100px) translateY(20px) rotate(10deg); } }

        iframe, [class*="tiiny"], .tiiny-host-badge { display: none !important; }
    </style>
</head>
<body>

    <div id="game-terminal">
        <div class="top-bar">
            <span>SES: <span style="color:#00ff41">AKTİF</span></span>
            <span class="badge">DOSYA: V.I.L.E-2026</span>
        </div>

        <div class="main-screen" id="main-screen">
            <div class="img-frame">
                <img id="scene-image" src="" alt="Mission Location">
            </div>
            <div id="game-text" class="log-text"></div>
            
            <div id="dynamic-content"></div> 
            <div id="clue-box" style="margin-top:10px; font-size:13px; color:#888; font-style:italic;"></div>
        </div>

        <div class="control-panel" id="controls"></div>

        <div id="plane-animation">
            <div class="plane-icon">✈️</div>
            <div style="color:#00ff41; margin-top:20px;">HEDEF BÖLGEYE GİDİLİYOR...</div>
        </div>
    </div>

    <script>
        // GOOGLE FORM LİNKİN
        const googleFormLink = "https://docs.google.com/forms/d/e/1FAIpQLSetNN9DLHIN1mmEnwXKEljiq9I5lePMQ11LIjSjmBzvjc-qjA/viewform?usp=sharing&ouid=116024969586397151226"; 

        let score = 100;
        let selectedItem = null;
        let typeWriterInterval;

        // --- SES MOTORU (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        // Telsiz Cızırtısı Sesi (White Noise)
        function playStaticNoise() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const bufferSize = audioCtx.sampleRate * 0.5; // 0.5 saniye
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            const gainNode = audioCtx.createGain();
            gainNode.gain.value = 0.05; // Ses seviyesi
            noise.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            noise.start();
        }

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if(type==='typewriter'){
                // Tık sesi
                osc.type='square'; osc.frequency.setValueAtTime(800, audioCtx.currentTime); 
                gainNode.gain.setValueAtTime(0.02, audioCtx.currentTime); 
                osc.start(); osc.stop(audioCtx.currentTime+0.05);
            }
            else if(type==='fly'){ 
                osc.frequency.setValueAtTime(150, audioCtx.currentTime); 
                osc.frequency.linearRampToValueAtTime(50, audioCtx.currentTime+1); 
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); 
                osc.start(); osc.stop(audioCtx.currentTime+1); 
            }
            else if(type==='success'){ 
                osc.type='sine'; osc.frequency.setValueAtTime(600, audioCtx.currentTime); 
                osc.frequency.linearRampToValueAtTime(1200, audioCtx.currentTime+0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); 
                osc.start(); osc.stop(audioCtx.currentTime+0.2); 
            }
            else { 
                // Error (Kalın Bop)
                osc.type='sawtooth'; osc.frequency.setValueAtTime(100, audioCtx.currentTime); 
                gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime); 
                osc.start(); osc.stop(audioCtx.currentTime+0.3); 
            }
        }

        const scenario = [
            {
                id: 0,
                location: "SİBİRYA ARAŞTIRMA ÜSSÜ",
                image: "https://images.unsplash.com/photo-1518182170546-0766aa6f7926?w=800",
                text: "GELEN MESAJ...<br>Ajan! Dr. Paralel Sibirya'da tespit edildi. İklim verilerini bozarak kaçtı. Bıraktığı izi sürmek için 'Hissedilen Sıcaklık' tablosunu çözmelisin.<br><br>VERİLER:<br>Hava: -10°C<br>Rüzgar: 20 km/sa<br><br>Tabloyu kullanarak hissedilen sıcaklığı (şifreyi) gir.",
                clue: "Hesap yapma. Tabloda -10 ve 20'nin kesişimini bul.",
                type: "input_table",
                correctAnswer: "-23",
                targetCorrect: 1,
                targetWrong: "wrong_0"
            },
            {
                id: "wrong_0",
                type: "dead_end",
                image: "https://images.unsplash.com/photo-1594716942733-149b533f5280?w=800",
                text: "BAĞLANTI HATASI!<br>Koordinat yanlış. Tablonun üst satırından -10'u, sol sütunundan 20'yi bul ve parmağınla birleştir.",
                choices: [{ text: "TEKRAR DENE", target: 0, cost: 5 }]
            },
            {
                id: 1,
                location: "NASA İKLİM MERKEZİ (ABD)",
                image: "https://images.unsplash.com/photo-1541873676-a18131494184?w=800",
                text: "ŞİFRE ONAYLANDI.<br>NASA uydularına erişim sağladık. Dr. Paralel, 1880 ve 2019 yıllarının sıcaklık haritalarını değiştirdi. Kendini 'En Çok Isınan' (En koyu kırmızı) bölgeye sakladı.<br><br>İki haritayı kıyasla ve saklandığı yeri bul.",
                clue: "Hangi bölge daha kırmızı? Ekvator mu, Kutuplar mı?",
                type: "map_compare",
                choices: [
                    { text: "A) EKVATOR ÇEVRESİ", target: "wrong_1", cost: 10 },
                    { text: "B) KUZEY KUTUP DAİRESİ", target: 2, cost: 0 },
                    { text: "C) ORTA KUŞAK ÇÖLLERİ", target: "wrong_1", cost: 10 }
                ]
            },
            {
                id: "wrong_1",
                type: "dead_end",
                image: "https://images.unsplash.com/photo-1569336415962-a4bd9f69cd83?w=800",
                text: "YANLIŞ BÖLGE!<br>Haritaya dikkatli bak. Ekvatordaki değişim az. Kutuplardaki kırmızılık çok daha yoğun.",
                choices: [{ text: "HARİTAYA GERİ DÖN", target: 1, cost: 5 }]
            },
            {
                id: 2,
                location: "İSVİÇRE ALPLERİ",
                image: "https://images.unsplash.com/photo-1531366936337-7c912a4589a7?w=800",
                text: "HEDEF TESPİT EDİLDİ.<br>Alplerdeyiz. Sıcaklık yapay olarak 3°C artırıldı. Soğuk seven 'Alpin Çiçekleri' tehlikede. Biyologlar onları bulamıyor.<br><br>İklim ısınınca bu bitkilerin yaşam alanı nereye kaymıştır?",
                clue: "Hava ısınırsa serinlik nerede bulunur? Aşağıda mı, yukarıda mı?",
                type: "choice",
                choices: [
                    { text: "A) DAĞIN ETEĞİNE (AŞAĞI)", target: "wrong_2", cost: 10 },
                    { text: "B) DAĞIN ZİRVESİNE (YUKARI)", target: 3, cost: 0 },
                    { text: "C) GÖL KENARINA (AYNI YER)", target: "wrong_2", cost: 10 }
                ]
            },
            {
                id: "wrong_2",
                type: "dead_end",
                image: "https://images.unsplash.com/photo-1502082553048-f009c37129b9?w=800",
                text: "BİTKİLER KURUDU!<br>Aşağılar daha sıcaktır. Isınan dünyada soğuk seven bitkiler daha yükseğe (Zirveye) kaçar.",
                choices: [{ text: "ZAMANI GERİ AL", target: 2, cost: 5 }]
            },
            {
                id: 3,
                location: "ENDONEZYA VOLKANI",
                image: "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=800",
                text: "ZİRVEDE BULUNDUK.<br>Son aşama: Dr. Paralel bir sürü afet yarattı. Haberlerde 'Hepsi İklim Değişikliği' deniyor ama biri YALAN. Biri yerin altından geliyor.<br><br>Hangisi atmosfer kökenli değildir (Jeolojiktir)?",
                clue: "Yerin altından geleni 'Doğal' kutusuna at.",
                type: "sort_game",
                targetCorrect: 4,
                items: [
                    { id: "i1", text: "Orman Yangını", type: "iklim" },
                    { id: "i2", text: "Volkan Patlaması", type: "jeolojik" },
                    { id: "i3", text: "Kuraklık", type: "iklim" },
                    { id: "i4", text: "Kasırga", type: "iklim" }
                ],
                zones: [
                    { id: "iklim", label: "İKLİM SİLAHI (ATMOSFER)" },
                    { id: "jeolojik", label: "DOĞAL (YERİN ALTI)" }
                ]
            },
            {
                id: 4,
                location: "SON KAÇIŞ ROTASI",
                image: "https://images.unsplash.com/photo-1521406606085-f37699317079?w=800",
                text: "KÖŞEYE SIKIŞTI!<br>Helikopterle kaçacak ama motoru <b>-40°C</b> ve altında donuyor.<br><br>Hangi hava durumunu seçerse motoru donar ve onu yakalarız?",
                clue: "Tabloda karşılığı -40 veya daha küçük (soğuk) olanı bul.",
                type: "choice_table",
                choices: [
                    { text: "A) HAVA -15 / RÜZGAR 10", target: "wrong_4", cost: 5 }, 
                    { text: "B) HAVA -10 / RÜZGAR 30", target: "wrong_4", cost: 5 }, 
                    { text: "C) HAVA -20 / RÜZGAR 30", target: 99, cost: 0 }  
                ]
            },
            {
                id: "wrong_4",
                type: "dead_end",
                image: "https://images.unsplash.com/photo-1517480447814-68894451016c?w=800",
                text: "HELİKOPTER KAÇTI!<br>Seçtiğin rotada motor donmadı. Tabloya tekrar bak.",
                choices: [{ text: "TEKRAR DENE", target: 4, cost: 5 }]
            },
            {
                id: 99,
                location: "GÖREV TAMAMLANDI",
                image: "https://images.unsplash.com/photo-1579546929518-9e396f3cc809?w=800",
                text: "OPERASYON BAŞARILI!<br>Dr. Paralel yakalandı. İklim dengesi sağlandı.<br><br>Aşağıdaki KODU kopyala ve Rapor Formuna yapıştır.",
                isEnd: true,
                choices: []
            }
        ];

        function startGame() { score = 100; playStaticNoise(); loadScene(0); }

        function showPlaneAnimation(callback) {
            const plane = document.getElementById("plane-animation");
            plane.style.display = "flex";
            playSound('fly');
            setTimeout(() => {
                plane.style.display = "none";
                callback();
            }, 1500);
        }

        function typeWriter(text, element, callback) {
            clearInterval(typeWriterInterval);
            element.innerHTML = "";
            let i = 0;
            const cleanText = text.replace(/<br>/g, "\n");
            
            // Daktilo efekti yerine, ses eşliğinde hızlıca yazdıralım (daha stabil)
            element.innerHTML = text;
            playStaticNoise(); // Her yeni mesajda telsiz sesi
        }

        function loadScene(sceneId) {
            const scene = scenario.find(s => s.id === sceneId);
            const controls = document.getElementById("controls");
            const textDiv = document.getElementById("game-text");
            const contentDiv = document.getElementById("dynamic-content");
            const image = document.getElementById("scene-image");
            
            controls.innerHTML = "";
            contentDiv.innerHTML = "";
            document.getElementById("clue-box").innerText = scene.clue || "";
            image.src = scene.image;

            // Yazıyı ve Sesi Başlat
            typeWriter(scene.text, textDiv);

            // İÇERİK TİPLERİ
            if(scene.type === "input_table" || scene.type === "choice_table") {
                renderTable(contentDiv);
            }
            if(scene.type === "map_compare") {
                contentDiv.innerHTML = `
                    <div style="display:flex; gap:5px; overflow-x:auto;">
                        <div style="flex:1; min-width:150px; text-align:center; color:#fff;">
                            <img src="https://svs.gsfc.nasa.gov/vis/a000000/a004700/a004787/1884_Region.jpg" style="width:100%; border:1px solid #555;">
                            <br>1880 YILI
                        </div>
                        <div style="flex:1; min-width:150px; text-align:center; color:#ff5555;">
                            <img src="https://svs.gsfc.nasa.gov/vis/a000000/a004700/a004787/2019_Region.jpg" style="width:100%; border:1px solid #f00;">
                            <br>2019 YILI
                        </div>
                    </div>`;
            }

            // KONTROLLER
            if(scene.type === "input_table") {
                contentDiv.innerHTML += `<div class="input-group"><input type="text" id="ans" placeholder="ŞİFRE..."><button onclick="checkInput('${scene.correctAnswer}', ${scene.targetCorrect}, '${scene.targetWrong}')">GİRİŞ</button></div>`;
            } 
            else if(scene.type === "sort_game") {
                renderDragGame(scene, contentDiv);
            }
            else if(scene.isEnd) {
                const code = `GEO-${Math.floor(Math.random()*1000)}-${score}`;
                contentDiv.innerHTML = `<div style="border:2px dashed #00ff41; padding:20px; text-align:center; font-size:24px; margin:20px 0;">${code}</div>`;
                controls.innerHTML = `<button onclick="window.open('${googleFormLink}', '_blank')">RAPORU GÖNDER >></button><button onclick="startGame()">YENİ GÖREV</button>`;
            }
            else if(scene.choices) {
                scene.choices.forEach(c => {
                    const btn = document.createElement("button");
                    btn.innerText = c.text;
                    if(scene.type==="dead_end") btn.classList.add("btn-red");
                    btn.onclick = () => {
                        if(c.target.toString().startsWith("wrong") || scene.type==="dead_end") {
                            playSound('error'); if(c.cost) score-=c.cost; loadScene(c.target);
                        } else {
                            playSound('success'); if(c.cost) score-=c.cost;
                            showPlaneAnimation(() => loadScene(c.target));
                        }
                    };
                    controls.appendChild(btn);
                });
            }
        }

        function renderTable(container) {
            container.innerHTML = `
            <div class="table-wrapper">
                <table class="data-table">
                    <tr><th style="background:#444">RÜZGAR \\ HAVA</th><th>5°C</th><th>0°C</th><th>-5°C</th><th>-10°C</th><th>-15°C</th><th>-20°C</th></tr>
                    <tr><th>Sakin</th><td>5</td><td>0</td><td>-5</td><td>-10</td><td>-15</td><td>-20</td></tr>
                    <tr><th>10 km/sa</th><td>2</td><td>-3</td><td>-9</td><td>-14</td><td>-20</td><td>-26</td></tr>
                    <tr><th>20 km/sa</th><td>-3</td><td>-10</td><td>-16</td><td>-23</td><td>-29</td><td>-35</td></tr>
                    <tr><th>30 km/sa</th><td>-6</td><td>-13</td><td>-20</td><td>-27</td><td>-34</td><td>-42</td></tr>
                    <tr><th>40 km/sa</th><td>-4</td><td>-15</td><td>-22</td><td>-29</td><td>-36</td><td>-43</td></tr>
                </table>
            </div>`;
        }

        function checkInput(correct, success, fail) {
            const val = document.getElementById("ans").value.trim();
            if(val === correct) { playSound('success'); showPlaneAnimation(() => loadScene(success)); }
            else { playSound('error'); score-=5; loadScene(fail); }
        }

        // --- SÜRÜKLE BIRAK ---
        function renderDragGame(scene, container) {
            const dragDiv = document.createElement("div");
            dragDiv.className = "drag-area";
            let poolHTML = ""; scene.items.forEach(i => poolHTML += `<div class="item" id="${i.id}" data-type="${i.type}" onclick="selectItem(this)">${i.text}</div>`);
            let zonesHTML = ""; scene.zones.forEach(z => zonesHTML += `<div class="zone" id="${z.id}" onclick="placeItem(this, ${scene.targetCorrect})"><h4>${z.label}</h4></div>`);
            dragDiv.innerHTML = `<div class="pool" id="pool">${poolHTML}</div><div class="zones">${zonesHTML}</div>`;
            container.appendChild(dragDiv);
        }

        function selectItem(el) {
            if(el.parentElement.classList.contains("zone")) return;
            document.querySelectorAll(".item").forEach(i => i.classList.remove("selected"));
            el.classList.add("selected");
            selectedItem = el;
            document.querySelectorAll(".zone").forEach(z => z.classList.add("active"));
        }

        function placeItem(zone, successTarget) {
            if(!selectedItem) return;
            zone.appendChild(selectedItem);
            selectedItem.classList.remove("selected");
            selectedItem = null;
            document.querySelectorAll(".zone").forEach(z => z.classList.remove("active"));
            if(document.getElementById("pool").children.length === 0) {
                let correct = true;
                document.querySelectorAll(".zone").forEach(z => {
                    Array.from(z.children).forEach(c => { if(c.classList.contains("item") && c.dataset.type !== z.id) correct = false; });
                });
                if(correct) { 
                    playSound('success'); 
                    document.getElementById("controls").innerHTML = `<button onclick="showPlaneAnimation(() => loadScene(${successTarget}))">ONAYLANDI: DEVAM ET >></button>`;
                } else {
                    playSound('error'); score-=10;
                    alert("HATA: Veriler yanlış kutularda!");
                    const scene = scenario.find(s => s.type === "sort_game");
                    loadScene(scene.id);
                }
            }
        }
    </script>
</body>
</html>
